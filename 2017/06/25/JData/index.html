<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>京东JData算法大赛 | Lancelot&#39;s Desert</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="比赛简介 本次大赛以京东商城真实的用户、商品和行为数据（脱敏后）为基础，参赛队伍需要通过数据挖掘的技术和机器学习的算法，构建用户购买商品的预测模型，输出高潜用户和目标商品的匹配结果，为精准营销提供高质量的目标群体。同时，希望参赛队伍能通过本次比赛，挖掘数据背后潜在的意义，为电商用户提供更简单、快捷、省心的购物体验。">
<meta name="keywords" content="ML,JData,比赛">
<meta property="og:type" content="article">
<meta property="og:title" content="京东JData算法大赛">
<meta property="og:url" content="http://yoursite.com/2017/06/25/JData/index.html">
<meta property="og:site_name" content="Lancelot&#39;s Desert">
<meta property="og:description" content="比赛简介 本次大赛以京东商城真实的用户、商品和行为数据（脱敏后）为基础，参赛队伍需要通过数据挖掘的技术和机器学习的算法，构建用户购买商品的预测模型，输出高潜用户和目标商品的匹配结果，为精准营销提供高质量的目标群体。同时，希望参赛队伍能通过本次比赛，挖掘数据背后潜在的意义，为电商用户提供更简单、快捷、省心的购物体验。">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/A.jpg">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/B.jpg">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/week_purchase.png">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/month_2_buy.png">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/month_3_buy.png">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/month_4_buy.png">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/week_cate_buy.png">
<meta property="og:image" content="http://yoursite.com/materials/img/JData/month_cate_buy.png">
<meta property="og:updated_time" content="2017-07-16T13:04:56.329Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="京东JData算法大赛">
<meta name="twitter:description" content="比赛简介 本次大赛以京东商城真实的用户、商品和行为数据（脱敏后）为基础，参赛队伍需要通过数据挖掘的技术和机器学习的算法，构建用户购买商品的预测模型，输出高潜用户和目标商品的匹配结果，为精准营销提供高质量的目标群体。同时，希望参赛队伍能通过本次比赛，挖掘数据背后潜在的意义，为电商用户提供更简单、快捷、省心的购物体验。">
<meta name="twitter:image" content="http://yoursite.com/materials/img/JData/A.jpg">
  
    <link rel="alternative" href="/atom.xml" title="Lancelot&#39;s Desert" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.b3331d.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-75468489-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="https://ooo.0o0.ooo/2017/05/29/592be5c575c4c.jpg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">懒死骆驼</a></h1>
		</hgroup>
		
		<p class="header-subtitle">细水长流，温润如玉</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/Reading/">阅读</a></li>
	        
				<li><a href="/tags/ML/">机器学习</a></li>
	        
				<li><a href="/tags/Coding/">编程</a></li>
	        
				<li><a href="/about">关于</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/LancelotHolmes/" title="github"><i class="icon-github"></i></a>
		        
					<a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="douban" target="_blank" href="https://www.douban.com/people/127803731/" title="douban"><i class="icon-douban"></i></a>
		        
					<a class="segmentfault" target="_blank" href="https://segmentfault.com/u/fornever" title="segmentfault"><i class="icon-segmentfault"></i></a>
		        
					<a class="mail" target="_blank" href="mailto:494852624@qq.com" title="mail"><i class="icon-mail"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="https://ooo.0o0.ooo/2017/05/29/592be5c575c4c.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">懒死骆驼</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>细水长流，温润如玉<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/LancelotHolmes/" title="github"><i class="icon-github"></i></a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="douban" target="_blank" href="https://www.douban.com/people/127803731/" title="douban"><i class="icon-douban"></i></a>
			        
						<a class="segmentfault" target="_blank" href="https://segmentfault.com/u/fornever" title="segmentfault"><i class="icon-segmentfault"></i></a>
			        
						<a class="mail" target="_blank" href="mailto:494852624@qq.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 20%"><a href="/">主页</a></li>
		        
					<li style="width: 20%"><a href="/tags/Reading/">阅读</a></li>
		        
					<li style="width: 20%"><a href="/tags/ML/">机器学习</a></li>
		        
					<li style="width: 20%"><a href="/tags/Coding/">编程</a></li>
		        
					<li style="width: 20%"><a href="/about">关于</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            <article id="post-JData" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      京东JData算法大赛
    </h1>
  

        
        <a href="/2017/06/25/JData/" class="archive-article-date">
  	<time datetime="2017-06-25T06:04:31.000Z" itemprop="datePublished">2017-06-25</time>
  	<span id="busuanzi_container_page_pv" style="color:DarkGray">
      view <span id="busuanzi_value_page_pv"></span> times
    </span>
</a>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      

        
                       
             <div id="toc" class="article-toc">
             <h2>目录</h2>
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#比赛简介"><span class="toc-number">1.</span> <span class="toc-text">比赛简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于比赛的一点思考"><span class="toc-number">2.</span> <span class="toc-text">关于比赛的一点思考</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#推荐算法？"><span class="toc-number">2.1.</span> <span class="toc-text">推荐算法？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#与以往比赛的区别"><span class="toc-number">2.2.</span> <span class="toc-text">与以往比赛的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据分析和预处理"><span class="toc-number">3.</span> <span class="toc-text">数据分析和预处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#官方信息"><span class="toc-number">3.1.</span> <span class="toc-text">官方信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FAQ中的一些信息"><span class="toc-number">3.2.</span> <span class="toc-text">FAQ中的一些信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据集解析"><span class="toc-number">3.3.</span> <span class="toc-text">数据集解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异常值判断"><span class="toc-number">3.4.</span> <span class="toc-text">异常值判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据背景信息"><span class="toc-number">3.5.</span> <span class="toc-text">数据背景信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#空值判断"><span class="toc-number">3.6.</span> <span class="toc-text">空值判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#未知记录"><span class="toc-number">3.7.</span> <span class="toc-text">未知记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据一致性验证"><span class="toc-number">3.8.</span> <span class="toc-text">数据一致性验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重复记录分析"><span class="toc-number">3.9.</span> <span class="toc-text">重复记录分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#检查是否存在注册时间在2016年-4月-15号之后的用户"><span class="toc-number">3.10.</span> <span class="toc-text">检查是否存在注册时间在2016年-4月-15号之后的用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#行为数据中的user-id为浮点型，进行INT类型转换"><span class="toc-number">3.11.</span> <span class="toc-text">行为数据中的user_id为浮点型，进行INT类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#按照星期对用户购买行为进行分析"><span class="toc-number">3.12.</span> <span class="toc-text">按照星期对用户购买行为进行分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一个月中各天购买量"><span class="toc-number">3.13.</span> <span class="toc-text">一个月中各天购买量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2016年2月"><span class="toc-number">3.13.1.</span> <span class="toc-text">2016年2月</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2016年3月"><span class="toc-number">3.13.2.</span> <span class="toc-text">2016年3月</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2016年4月"><span class="toc-number">3.13.3.</span> <span class="toc-text">2016年4月</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#商品分类别销售统计"><span class="toc-number">3.14.</span> <span class="toc-text">商品分类别销售统计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#周一到周日各商品类别销售情况"><span class="toc-number">3.14.1.</span> <span class="toc-text">周一到周日各商品类别销售情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#每月各类商品销售情况（只关注商品8）"><span class="toc-number">3.14.2.</span> <span class="toc-text">每月各类商品销售情况（只关注商品8）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2016年2，3，4月"><span class="toc-number">3.14.2.1.</span> <span class="toc-text">2016年2，3，4月</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#特征工程"><span class="toc-number">4.</span> <span class="toc-text">特征工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用户特征"><span class="toc-number">4.1.</span> <span class="toc-text">用户特征</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#用户基本特征"><span class="toc-number">4.1.1.</span> <span class="toc-text">用户基本特征</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#商品特征"><span class="toc-number">4.2.</span> <span class="toc-text">商品特征</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#商品基本特征"><span class="toc-number">4.2.1.</span> <span class="toc-text">商品基本特征</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#评论特征"><span class="toc-number">4.3.</span> <span class="toc-text">评论特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#行为特征"><span class="toc-number">4.4.</span> <span class="toc-text">行为特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户-行为"><span class="toc-number">4.5.</span> <span class="toc-text">用户-行为</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#累积用户特征"><span class="toc-number">4.5.1.</span> <span class="toc-text">累积用户特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用户近期行为特征"><span class="toc-number">4.5.2.</span> <span class="toc-text">用户近期行为特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#用户对同类别下各种商品的行为"><span class="toc-number">4.5.3.</span> <span class="toc-text">用户对同类别下各种商品的行为</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#商品-行为"><span class="toc-number">4.6.</span> <span class="toc-text">商品-行为</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#累积商品特征"><span class="toc-number">4.6.1.</span> <span class="toc-text">累积商品特征</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类别特征"><span class="toc-number">4.7.</span> <span class="toc-text">类别特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造训练集-验证集"><span class="toc-number">4.8.</span> <span class="toc-text">构造训练集/验证集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造测试集"><span class="toc-number">4.9.</span> <span class="toc-text">构造测试集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模型设计和评估"><span class="toc-number">5.</span> <span class="toc-text">模型设计和评估</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#训练模型"><span class="toc-number">5.1.</span> <span class="toc-text">训练模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对验证集进行线下测试"><span class="toc-number">5.2.</span> <span class="toc-text">对验证集进行线下测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#输出特征重要性"><span class="toc-number">5.3.</span> <span class="toc-text">输出特征重要性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#生成提交结果"><span class="toc-number">5.4.</span> <span class="toc-text">生成提交结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#提交结果除重（可选）"><span class="toc-number">5.5.</span> <span class="toc-text">提交结果除重（可选）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#比赛过程中遇到和解决的问题"><span class="toc-number">6.</span> <span class="toc-text">比赛过程中遇到和解决的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#线上线下测试的分相差悬殊问题"><span class="toc-number">6.1.</span> <span class="toc-text">线上线下测试的分相差悬殊问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线下测试集组数"><span class="toc-number">6.2.</span> <span class="toc-text">线下测试集组数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编码问题"><span class="toc-number">6.3.</span> <span class="toc-text">编码问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#feature-importance列未对应，导致一段时间分析的特征重要性文件存在问题，产生误导"><span class="toc-number">6.4.</span> <span class="toc-text">feature_importance列未对应，导致一段时间分析的特征重要性文件存在问题，产生误导</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#合并数据集时产生空值，由数据不一致造成"><span class="toc-number">6.5.</span> <span class="toc-text">合并数据集时产生空值，由数据不一致造成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#除零出现无限值"><span class="toc-number">6.6.</span> <span class="toc-text">除零出现无限值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化时间计算效率"><span class="toc-number">6.7.</span> <span class="toc-text">优化时间计算效率</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#失败的尝试以及未尝试的"><span class="toc-number">7.</span> <span class="toc-text">失败的尝试以及未尝试的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">8.</span> <span class="toc-text">后记</span></a></li></ol>  
            </div>
            <script type="text/javascript">
               var _article = document.getElementsByClassName('article')[0];
               <!-- setTimeout("_article.style.marginRight = '211px'",0);  -->
               setTimeout("_article.className += ' article2'",0); 
               setTimeout("document.getElementById('toc').style.right = '15px'", 0);                
             </script>
           
         

        <h2 id="比赛简介"><a href="#比赛简介" class="headerlink" title="比赛简介"></a>比赛简介</h2><blockquote>
<p>本次大赛以京东商城真实的用户、商品和行为数据（脱敏后）为基础，参赛队伍需要通过数据挖掘的技术和机器学习的算法，构建用户购买商品的预测模型，输出高潜用户和目标商品的匹配结果，为精准营销提供高质量的目标群体。同时，希望参赛队伍能通过本次比赛，挖掘数据背后潜在的意义，为电商用户提供更简单、快捷、省心的购物体验。<br><a id="more"></a></p>
</blockquote>
<p>这是2017年京东举办的一场数据挖掘比赛，<a href="http://www.datafountain.cn/#/competitions/247/intro" target="_blank" rel="external">比赛地址</a>，吸引了不少人参加，和实验室的两个同学也一起参加进来体验一下真实比赛的氛围，总的来说整个过程确实比较辛苦，不过也算是痛并快乐着。看过赛题的朋友可能大多会和往年的阿里移动推荐大赛作比较，甚至更早一点的天猫推荐大赛比较，总的来说，确实很相像，目的都是以用户的历史行为记录以及商品、用户的一些特征来构建模型，预测用户未来的购买状况。</p>
<p>我们团队的最终比赛成绩如下，A榜排名139/4240，B榜排名97/4240<br><img src="/materials/img/JData/A.jpg" alt="a"></p>
<p><img src="/materials/img/JData/B.jpg" alt="b"></p>
<h2 id="关于比赛的一点思考"><a href="#关于比赛的一点思考" class="headerlink" title="关于比赛的一点思考"></a>关于比赛的一点思考</h2><h3 id="推荐算法？"><a href="#推荐算法？" class="headerlink" title="推荐算法？"></a>推荐算法？</h3><p>首先针对题目的目的需要明确一点，这并不是如比赛标题所言的那种构建<strong>推荐系统</strong>类型的比赛，关于这一点，我想引用网上大牛的原话来说明</p>
<ul>
<li><p>首先引用阿里移动推荐比赛内部赛的冠军<a href="https://bbs.aliyun.com/read/153103.html?spm=0.0.0.0.QmriRM" target="_blank" rel="external">算者</a>最后获胜时的文章中的内容</p>
<blockquote>
<p>1、代价不同。你推荐给我一首歌，不好听，大不了换一首，不好听，再换，最后总能找到自己喜欢的歌。可是购物呢，你推荐我一个服装品牌，我花了半个月的伙食费买了，等待了几天，到货后发现不满意，怎么办？扔掉？太可惜了！穿在身上？天天别扭！退掉？还要再花点邮费！不管结局怎们样，总之不爽。如果是买个家居什么的，不喜欢的话，可能后悔一辈子。所以购物的用户体验周期要远长于音乐、影视推荐。推荐的试错成本很大。<br>2、需求的单一性与喜好的相似性。喜欢看动作片，那么相似的动作片我都能看一遍。但是购物就不同了，购物更多的是刚需，喜欢可爱的衣服，一般人也不会把所有喜欢的可爱的衣服都买下来，更多的是每个季节只买一件。家居类的频次就低了，可能一辈子就买一次。不同的类目的需求频率是不一样的。</p>
</blockquote>
</li>
<li><p>另一个是天猫推荐算法大赛的top9的<a href="http://www.csdn.net/article/2014-08-27/2821403-the-top-9-of-ali-bigdata-competition/8" target="_blank" rel="external">获奖感言</a>里提到的</p>
<blockquote>
<p>和很多拿到这个问题的同学一样，一开始都觉得是推荐问题，那么通过查阅相关资料自然而然的都是协同过滤等相关推荐算法，实际效果可想而知。具体原因我认为是品牌的转移成本，具体是什么意思呢？打个比方，一个普通的消费者，前三个月某一天购买了苹果的一款手机，根据商品相似等算法我们可能得到苹果和三星很相似，然后在第四个月系统向他推荐了三星，从一个消费者的正常心理来看，这种推荐很难促成交易的发生。也许这个比方不太恰当，但是这个例子反映的信息包括品牌的实际周期，用户对品牌的黏度，消费能力，还有时间季节等因素，我们仅仅通过赛题给出的字段很难分析出这些因素，而这些都是反映品牌的转移成本的关键因素，因为购买行为的发生不是一个单步，而是涉及到很多前因后果以及最终的整体相关性的问题。基于以上考虑，实际上留给我们的就是挖掘买买相关，看买相关的这部分信息，从这点出发这次的问题实际上就是一个有监督的二分类问题。</p>
</blockquote>
</li>
</ul>
<p>通过以上的观点可以看到本题并非协同过滤算法那种构建推荐系统的比赛，而是一种根据离线历史行为记录预测用户未来某段时间买了又买的可能性</p>
<h3 id="与以往比赛的区别"><a href="#与以往比赛的区别" class="headerlink" title="与以往比赛的区别"></a>与以往比赛的区别</h3><p>抛开数据量等的区别，本次比赛与天猫、阿里推荐算法大赛的最主要的区别在于本次比赛并非预测未来某一天的可能发生购买行为的用户商品对，而是预测<strong>未来5天</strong>可能发生购买行为的用户商品对，如果说预测未来一天可能发生购买行为的用户商品对难以捕捉到当天购买（冲动消费等）的用户行为，那么把时间跨度加大到5天的话其实我们就间接地损失了不少可能预测出的用户商品对：</p>
<ul>
<li>首先根据我们的统计结果，大部分发生购买行为的用户商品对的交互在前三~五天，这也是在分析以前的一些比赛的ppt里提到的时间衰减规律的类似结论</li>
<li>此外，取某一个时间区间发生购买行为的用户商品对分析用户对该商品的交互行为，发现在这五天再往前取三天左右的时间交互的用户商品对仅占所有发生购买行为的用户商品对的约四分之一，仅用户的话能占到约一半，但是其中有四分之一的用户在这三天交互的对象并不是后五天购买的了的目标对象，而剩下的一半用户在这三天根本没有交互行为；而究其原因就是预测后五天的用户商品对购买情况的话，这五天对于我们而言就是一个黑匣子，而统计结果却显示我们需要目标时间点最近三天的交互状况，所以造成了预测的困难，后期也曾想过使用类似关联分析之类的方法，然而受精力时间限制也没尝试，所以这也是一个遗憾，不知道那些大牛是怎么处理的。</li>
</ul>
<p>接下来我就简单的从三个步骤来介绍下我们团队在这场比赛所做的一些尝试</p>
<ul>
<li>数据分析和预处理</li>
<li>特征工程</li>
<li>模型设计和评估</li>
</ul>
<h2 id="数据分析和预处理"><a href="#数据分析和预处理" class="headerlink" title="数据分析和预处理"></a>数据分析和预处理</h2><h3 id="官方信息"><a href="#官方信息" class="headerlink" title="官方信息"></a>官方信息</h3><ul>
<li>符号定义：<ul>
<li>S：提供的商品全集；</li>
<li>P：候选的商品子集，P是S的子集；</li>
<li>U：用户集合；</li>
<li>A：用户对S的行为数据集合；</li>
<li>C：S的评价数据。</li>
</ul>
</li>
<li>数据<ul>
<li>按用途：<pre><code>* 训练数据（2016-2-1~2016-4-15）：用户集合U中的用户，对商品集合S中部分商品的行为、评价、用户数据；提供部分候选商品的数据P。
* 预测数据（2016-4-16~2016-4-20）：用户是否下单P(P为候选商品集)中的商品，**每个用户只会下单一个商品**
</code></pre></li>
<li>按类别<ul>
<li>用户：ID,年龄，性别，用户等级，用户注册日期</li>
<li>商品：商品编号，属性1，属性2，属性3，品类ID，品牌ID</li>
<li>评价：商品编号，累计评论数（分段），是否有差评，差评率</li>
<li>行为：用户编号，商品编号，行为时间，<strong>点击模块编号</strong>，类型（浏览，加入购物车，购物车删除，下单，关注，点击），品类ID，品牌ID</li>
</ul>
</li>
<li>注：<ul>
<li>自行组成特征和数据格式，自由组合训练测试数据比例</li>
<li>预测数据<strong>分A,B榜计算分数</strong></li>
<li>数据均采样和脱敏，存在空值</li>
<li>预测用户在未来<strong>5天内</strong>，对某个目标品类下商品的购买意向。对于训练集中出现的每一个用户，参赛者的模型需要预测该用户在未来5天内是否购买目标品类下的商品以及所购买商品的SKU_ID。</li>
</ul>
</li>
</ul>
</li>
<li>评分标准：所有用户在2016-04-16到2016-04-20是否下单<strong>P中的商品</strong><ul>
<li>是否下单： F11=6*Recall*Precise/(5*Recall+Precise)</li>
<li>若下单，预测下单的商品ID是否正确： F12=5*Recall*Precise/(2*Recall+3*Precise)</li>
<li>Score=0.4*F11 + 0.6*F12</li>
<li>Precise为精确率，Recall为召回率</li>
</ul>
</li>
</ul>
<h3 id="FAQ中的一些信息"><a href="#FAQ中的一些信息" class="headerlink" title="FAQ中的一些信息"></a>FAQ中的一些信息</h3><ul>
<li>提供的数据文件编码格式为GBK</li>
<li>一个用户（user_id）只购买一个所提供的候选商品集合P中的商品（sku_id）；用户购买候选商品集合P之外的商品无需提交</li>
<li>评论数据为截止到当日的累计数据</li>
<li>model_id表明用户在页面上点击了哪一个位置；数据中可能存在一些空值，有可能是异常值，也有可能是在页面上点击了一个空白的位置产生的数据,自行理解并处理</li>
<li>集合P为候选商品集合，即参赛者预测的结果中的sku需要在集合P中；集合S为行为数据中的商品全集；</li>
<li>日期格式统一为”yyyy-mm-dd”，时间格式统一为”yyyy-mm-dd hh:mi:ss”</li>
<li>关于用户表中存在10条记录，用户注册时间晚于2016年4月15日情况为真实生产环境中的异常数据,自行理解并处理</li>
</ul>
<h3 id="数据集解析"><a href="#数据集解析" class="headerlink" title="数据集解析"></a>数据集解析</h3><p>这里涉及到的数据集是京东最新的数据集：</p>
<ol>
<li>JData_User.csv             用户数据集           105,321个用户</li>
<li>JData_Comment.csv           商品评论             558,552条记录</li>
<li>JData_Product.csv           预测商品集合           24,187条记录</li>
<li>JData_Action_201602.csv       2月份行为交互记录     11,485,424条记录</li>
<li>JData_Action_201603.csv       3月份行为交互记录     25,916,378条记录</li>
<li>JData_Action_201604.csv       4月份行为交互记录     13,199,934条记录</li>
</ol>
<h3 id="异常值判断"><a href="#异常值判断" class="headerlink" title="异常值判断"></a>异常值判断</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">%matplotlib inline</div><div class="line"><span class="keyword">import</span> matplotlib</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#定义文件名</span></div><div class="line">ACTION_201602_FILE = <span class="string">"data/JData_Action_201602.csv"</span></div><div class="line">ACTION_201603_FILE = <span class="string">"data/JData_Action_201603.csv"</span></div><div class="line">ACTION_201604_FILE = <span class="string">"data/JData_Action_201604.csv"</span></div><div class="line">COMMENT_FILE = <span class="string">"data/JData_Comment.csv"</span></div><div class="line">PRODUCT_FILE = <span class="string">"data/JData_Product.csv"</span></div><div class="line">USER_FILE = <span class="string">"data/JData_User.csv"</span></div><div class="line">USER_TABLE_FILE = <span class="string">"data/User_table.csv"</span></div><div class="line">ITEM_TABLE_FILE = <span class="string">"data/Item_table.csv"</span></div></pre></td></tr></table></figure>
<h3 id="数据背景信息"><a href="#数据背景信息" class="headerlink" title="数据背景信息"></a>数据背景信息</h3><p>根据官方给出的数据介绍里，可以知道数据可能存在哪些异常信息</p>
<ul>
<li>用户文件<ul>
<li>用户的age存在未知的情况，标记为-1</li>
<li>用户的sex存在保密情况，标记为2</li>
<li>后续分析发现，用户注册日期存在系统异常导致在预测日之后的情况，不过目前针对该特征没有想法，所以不作处理</li>
</ul>
</li>
<li>商品文件<ul>
<li>属性a1,a2,a3均存在未知情形，标记为-1</li>
</ul>
</li>
<li>行为文件<ul>
<li>model_id为点击模块编号，针对用户的行为类型为6时，可能存在空值</li>
</ul>
</li>
</ul>
<h3 id="空值判断"><a href="#空值判断" class="headerlink" title="空值判断"></a>空值判断</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_empty</span><span class="params">(file_path, file_name)</span>:</span></div><div class="line">    df_file = pd.read_csv(file_path)</div><div class="line">    <span class="keyword">print</span> <span class="string">'Is there any missing value in &#123;0&#125;? &#123;1&#125;'</span>.format(file_name, df_file.isnull().any().any()) </div><div class="line"></div><div class="line">check_empty(USER_FILE, <span class="string">'User'</span>)</div><div class="line">check_empty(ACTION_201602_FILE, <span class="string">'Action 2'</span>)</div><div class="line">check_empty(ACTION_201603_FILE, <span class="string">'Action 3'</span>)</div><div class="line">check_empty(ACTION_201604_FILE, <span class="string">'Action 4'</span>)</div><div class="line">check_empty(COMMENT_FILE, <span class="string">'Comment'</span>)</div><div class="line">check_empty(PRODUCT_FILE, <span class="string">'Product'</span>)</div></pre></td></tr></table></figure>
<pre><code>Is there any missing value in User? True
Is there any missing value in Action 2? True
Is there any missing value in Action 3? True
Is there any missing value in Action 4? True
Is there any missing value in Comment? False
Is there any missing value in Product? False
</code></pre><p>由上述简单的分析可知，用户表及行为表中均存在空值记录，而评论表和商品表则不存在，但是结合之前的数据背景分析商品表中存在属性未知的情况，后续也需要针对分析，进一步的我们看看用户表和行为表中的空值情况</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">empty_detail</span><span class="params">(f_path, f_name)</span>:</span></div><div class="line">    df_file = pd.read_csv(f_path)</div><div class="line">    <span class="keyword">print</span> <span class="string">'empty info in detail of &#123;0&#125;:'</span>.format(f_name)</div><div class="line">    <span class="keyword">print</span> pd.isnull(df_file).any()</div><div class="line"></div><div class="line">empty_detail(USER_FILE, <span class="string">'User'</span>)</div><div class="line">empty_detail(ACTION_201602_FILE, <span class="string">'Action 2'</span>)</div><div class="line">empty_detail(ACTION_201603_FILE, <span class="string">'Action 3'</span>)</div><div class="line">empty_detail(ACTION_201604_FILE, <span class="string">'Action 4'</span>)</div></pre></td></tr></table></figure>
<pre><code>empty info in detail of User:
user_id        False
age             True
sex             True
user_lv_cd     False
user_reg_tm     True
dtype: bool
empty info in detail of Action 2:
user_id     False
sku_id      False
time        False
model_id     True
type        False
cate        False
brand       False
dtype: bool
empty info in detail of Action 3:
user_id     False
sku_id      False
time        False
model_id     True
type        False
cate        False
brand       False
dtype: bool
empty info in detail of Action 4:
user_id     False
sku_id      False
time        False
model_id     True
type        False
cate        False
brand       False
dtype: bool
</code></pre><p>上面简单的输出了下存在空值的文件中具体哪些列存在空值(True)，结果如下</p>
<ul>
<li>User<ul>
<li>age</li>
<li>sex</li>
<li>user_reg_tm</li>
</ul>
</li>
<li>Action<ul>
<li>model_id</li>
</ul>
</li>
</ul>
<p>接下来具体看看各文件中的空值情况：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">empty_records</span><span class="params">(f_path, f_name, col_name)</span>:</span></div><div class="line">    df_file = pd.read_csv(f_path)</div><div class="line">    missing = df_file[col_name].isnull().sum().sum()</div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of missing &#123;0&#125; in &#123;1&#125; is &#123;2&#125;'</span>.format(col_name, f_name, missing) </div><div class="line">    <span class="keyword">print</span> <span class="string">'percent: '</span>, missing * <span class="number">1.0</span> / df_file.shape[<span class="number">0</span>]</div><div class="line"></div><div class="line">empty_records(USER_FILE, <span class="string">'User'</span>, <span class="string">'age'</span>)</div><div class="line">empty_records(USER_FILE, <span class="string">'User'</span>, <span class="string">'sex'</span>)</div><div class="line">empty_records(USER_FILE, <span class="string">'User'</span>, <span class="string">'user_reg_tm'</span>)</div><div class="line">empty_records(ACTION_201602_FILE, <span class="string">'Action 2'</span>, <span class="string">'model_id'</span>)</div><div class="line">empty_records(ACTION_201603_FILE, <span class="string">'Action 3'</span>, <span class="string">'model_id'</span>)</div><div class="line">empty_records(ACTION_201604_FILE, <span class="string">'Action 4'</span>, <span class="string">'model_id'</span>)</div></pre></td></tr></table></figure>
<pre><code>No. of missing age in User is 3
percent:  2.84843478509e-05
No. of missing sex in User is 3
percent:  2.84843478509e-05
No. of missing user_reg_tm in User is 3
percent:  2.84843478509e-05
No. of missing model_id in Action 2 is 4959617
percent:  0.431818363867
No. of missing model_id in Action 3 is 10553261
percent:  0.4072043169
No. of missing model_id in Action 4 is 5143018
percent:  0.38962452388
</code></pre><p>对比下数据集的记录数：</p>
<table>
<thead>
<tr>
<th>文件</th>
<th>文件说明</th>
<th>记录数</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. JData_User.csv</td>
<td>用户数据集</td>
<td>105,321个用户</td>
</tr>
<tr>
<td>2. JData_Comment.csv</td>
<td>商品评论</td>
<td>558,552条记录</td>
</tr>
<tr>
<td>3. JData_Product.csv</td>
<td>预测商品集合</td>
<td>24,187条记录</td>
</tr>
<tr>
<td>4. JData_Action_201602.csv</td>
<td>2月份行为交互记录</td>
<td>11,485,424条记录</td>
</tr>
<tr>
<td>5. JData_Action_201603.csv</td>
<td>3月份行为交互记录</td>
<td>25,916,378条记录</td>
</tr>
<tr>
<td>6. JData_Action_201604.csv</td>
<td>4月份行为交互记录</td>
<td>13,199,934条记录</td>
</tr>
</tbody>
</table>
<p>两相对比结合前面输出的情况，针对不同数据进行不同处理</p>
<ul>
<li>用户文件 <ul>
<li>age,sex:先填充为对应的未知状态（-1|2），后续作为未知状态的值进一步分析和处理</li>
<li>user_reg_tm:暂时不做处理</li>
</ul>
</li>
<li>行为文件<ul>
<li>model_id涉及数目接近一半，而且当前针对该特征没有很好的处理方法，待定</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">user = pd.read_csv(USER_FILE)</div><div class="line">user[<span class="string">'age'</span>].fillna(<span class="string">'-1'</span>, inplace=<span class="keyword">True</span>)</div><div class="line">user[<span class="string">'sex'</span>].fillna(<span class="number">2</span>, inplace=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> pd.isnull(user).any()</div></pre></td></tr></table></figure>
<pre><code>user_id        False
age            False
sex            False
user_lv_cd     False
user_reg_tm     True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nan_reg_tm = user[user[<span class="string">'user_reg_tm'</span>].isnull()]</div><div class="line"><span class="keyword">print</span> nan_reg_tm</div></pre></td></tr></table></figure>
<pre><code>       user_id age  sex  user_lv_cd user_reg_tm
34072   234073  -1  2.0           1         NaN
38905   238906  -1  2.0           1         NaN
67704   267705  -1  2.0           1         NaN
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> len(user[<span class="string">'age'</span>].unique())</div><div class="line"><span class="keyword">print</span> len(user[<span class="string">'sex'</span>].unique())</div><div class="line"><span class="keyword">print</span> len(user[<span class="string">'user_lv_cd'</span>].unique())</div></pre></td></tr></table></figure>
<pre><code>7
3
5
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">prod = pd.read_csv(PRODUCT_FILE)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> len(prod[<span class="string">'a1'</span>].unique())</div><div class="line"><span class="keyword">print</span> len(prod[<span class="string">'a2'</span>].unique())</div><div class="line"><span class="keyword">print</span> len(prod[<span class="string">'a3'</span>].unique())</div><div class="line"><span class="comment"># print len(prod['a2'].unique())</span></div><div class="line"><span class="keyword">print</span> len(prod[<span class="string">'brand'</span>].unique())</div></pre></td></tr></table></figure>
<pre><code>4
3
3
102
</code></pre><h3 id="未知记录"><a href="#未知记录" class="headerlink" title="未知记录"></a>未知记录</h3><p>接下来看看各个文件中的未知记录占的比重</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> <span class="string">'No. of unknown age user: &#123;0&#125; and the percent: &#123;1&#125; '</span>.format(user[user[<span class="string">'age'</span>]==<span class="string">'-1'</span>].shape[<span class="number">0</span>],</div><div class="line">                                                                  user[user[<span class="string">'age'</span>]==<span class="string">'-1'</span>].shape[<span class="number">0</span>]*<span class="number">1.0</span>/user.shape[<span class="number">0</span>])</div><div class="line"><span class="keyword">print</span> <span class="string">'No. of unknown sex user: &#123;0&#125; and the percent: &#123;1&#125; '</span>.format(user[user[<span class="string">'sex'</span>]==<span class="number">2</span>].shape[<span class="number">0</span>],</div><div class="line">                                                                  user[user[<span class="string">'sex'</span>]==<span class="number">2</span>].shape[<span class="number">0</span>]*<span class="number">1.0</span>/user.shape[<span class="number">0</span>])</div></pre></td></tr></table></figure>
<pre><code>No. of unknown age user: 14415 and the percent: 0.136867291423 
No. of unknown sex user: 54738 and the percent: 0.519725410887 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">unknown_records</span><span class="params">(f_path, f_name, col_name)</span>:</span></div><div class="line">    df_file = pd.read_csv(f_path)</div><div class="line">    missing = df_file[df_file[col_name]==<span class="number">-1</span>].shape[<span class="number">0</span>]</div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of unknown &#123;0&#125; in &#123;1&#125; is &#123;2&#125;'</span>.format(col_name, f_name, missing) </div><div class="line">    <span class="keyword">print</span> <span class="string">'percent: '</span>, missing * <span class="number">1.0</span> / df_file.shape[<span class="number">0</span>]</div><div class="line">    </div><div class="line">unknown_records(PRODUCT_FILE, <span class="string">'Product'</span>, <span class="string">'a1'</span>)</div><div class="line">unknown_records(PRODUCT_FILE, <span class="string">'Product'</span>, <span class="string">'a2'</span>)</div><div class="line">unknown_records(PRODUCT_FILE, <span class="string">'Product'</span>, <span class="string">'a3'</span>)</div></pre></td></tr></table></figure>
<pre><code>No. of unknown a1 in Product is 1701
percent:  0.0703270351842
No. of unknown a2 in Product is 4050
percent:  0.167445321867
No. of unknown a3 in Product is 3815
percent:  0.157729358746
</code></pre><p>小结一下</p>
<ul>
<li>空值部分对3条用户的sex,age填充为未知值,注册时间不作处理，此外行为数据部分model_id待定: 43.2%,40.7%,39.0%</li>
<li>未知值部分，用户age存在部分未知值: 13.7%，sex存在大量保密情况(超过一半) 52.0%</li>
<li>商品中各个属性存在部分未知的情况，a1&lt;a3&lt;a2，分别为： 7.0%,16.7%,15.8%</li>
</ul>
<h3 id="数据一致性验证"><a href="#数据一致性验证" class="headerlink" title="数据一致性验证"></a>数据一致性验证</h3><p>首先检查JData_User中的用户和JData_Action中的用户是否一致，保证行为数据中的所产生的行为均由用户数据中的用户产生（但是可能存在用户在行为数据中无行为）</p>
<p>思路：利用pd.Merge连接sku 和 Action中的sku, 观察Action中的数据是否减少</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_action_check</span><span class="params">()</span>:</span></div><div class="line">    df_user = pd.read_csv(<span class="string">'data/JData_User.csv'</span>)</div><div class="line">    df_sku = df_user.ix[:,<span class="string">'user_id'</span>].to_frame()</div><div class="line">    df_month2 = pd.read_csv(<span class="string">'data/JData_Action_201602.csv'</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'Is action of Feb. from User file? '</span>, len(df_month2) == len(pd.merge(df_sku,df_month2))</div><div class="line">    df_month3 = pd.read_csv(<span class="string">'data/JData_Action_201603.csv'</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'Is action of Mar. from User file? '</span>, len(df_month3) == len(pd.merge(df_sku,df_month3))</div><div class="line">    df_month4 = pd.read_csv(<span class="string">'data/JData_Action_201604.csv'</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'Is action of Apr. from User file? '</span>, len(df_month4) == len(pd.merge(df_sku,df_month4))</div><div class="line"></div><div class="line">user_action_check()</div></pre></td></tr></table></figure>
<pre><code>Is action of Feb. from User file?  True
Is action of Mar. from User file?  True
Is action of Apr. from User file?  True
</code></pre><p>结论： User数据集中的用户和交互行为数据集中的用户完全一致</p>
<p><em>根据merge前后的数据量比对，能保证Action中的用户ID是User中的ID的子集</em></p>
<h3 id="重复记录分析"><a href="#重复记录分析" class="headerlink" title="重复记录分析"></a>重复记录分析</h3><p>除去各个数据文件中完全重复的记录,结果证明线上成绩反而大幅下降，可能解释是重复数据是有意义的，比如用户同时购买多件商品，同时添加多个数量的商品到购物车等…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">deduplicate</span><span class="params">(filepath, filename, newpath)</span>:</span></div><div class="line">    df_file = pd.read_csv(filepath)       </div><div class="line">    before = df_file.shape[<span class="number">0</span>]</div><div class="line">    df_file.drop_duplicates(inplace=<span class="keyword">True</span>)</div><div class="line">    after = df_file.shape[<span class="number">0</span>]</div><div class="line">    n_dup = before-after</div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of duplicate records for '</span> + filename + <span class="string">' is: '</span> + str(n_dup)</div><div class="line">    <span class="keyword">if</span> n_dup != <span class="number">0</span>:</div><div class="line">        df_file.to_csv(newpath, index=<span class="keyword">None</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'no duplicate records in '</span> + filename</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># deduplicate('data/JData_Action_201602.csv', 'Feb. action', 'data/JData_Action_201602_dedup.csv')</span></div><div class="line">deduplicate(<span class="string">'data/JData_Action_201603.csv'</span>, <span class="string">'Mar. action'</span>, <span class="string">'data/JData_Action_201603_dedup.csv'</span>)</div><div class="line">deduplicate(<span class="string">'data/JData_Action_201604.csv'</span>, <span class="string">'Feb. action'</span>, <span class="string">'data/JData_Action_201604_dedup.csv'</span>)</div><div class="line">deduplicate(<span class="string">'data/JData_Comment.csv'</span>, <span class="string">'Comment'</span>, <span class="string">'data/JData_Comment_dedup.csv'</span>)</div><div class="line">deduplicate(<span class="string">'data/JData_Product.csv'</span>, <span class="string">'Product'</span>, <span class="string">'data/JData_Product_dedup.csv'</span>)</div><div class="line">deduplicate(<span class="string">'data/JData_User.csv'</span>, <span class="string">'User'</span>, <span class="string">'data/JData_User_dedup.csv'</span>)</div></pre></td></tr></table></figure>
<pre><code>No. of duplicate records for Mar. action is: 7085038
No. of duplicate records for Feb. action is: 3672710
No. of duplicate records for Comment is: 0
no duplicate records in Comment
No. of duplicate records for Product is: 0
no duplicate records in Product
No. of duplicate records for User is: 0
no duplicate records in User
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">IsDuplicated = df_month.duplicated() </div><div class="line">df_d=df_month[IsDuplicated]</div><div class="line">df_d.groupby(<span class="string">'type'</span>).count()               <span class="comment">#发现重复数据大多数都是由于浏览（1），或者点击(6)产生</span></div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>type</th>
<th>user_id</th>
<th>sku_id</th>
<th>time</th>
<th>model_id</th>
<th>cate</th>
<th>brand</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2176378</td>
<td>2176378</td>
<td>2176378</td>
<td>0</td>
<td>2176378</td>
<td>2176378</td>
</tr>
<tr>
<td>2</td>
<td>636</td>
<td>636</td>
<td>636</td>
<td>0</td>
<td>636</td>
<td>636</td>
</tr>
<tr>
<td>3</td>
<td>1464</td>
<td>1464</td>
<td>1464</td>
<td>0</td>
<td>1464</td>
<td>1464</td>
</tr>
<tr>
<td>4</td>
<td>37</td>
<td>37</td>
<td>37</td>
<td>0</td>
<td>37</td>
<td>37</td>
</tr>
<tr>
<td>5</td>
<td>1981</td>
<td>1981</td>
<td>1981</td>
<td>0</td>
<td>1981</td>
<td>1981</td>
</tr>
<tr>
<td>6</td>
<td>575597</td>
<td>575597</td>
<td>575597</td>
<td>545054</td>
<td>575597</td>
<td>575597</td>
</tr>
</tbody>
</table>
<h3 id="检查是否存在注册时间在2016年-4月-15号之后的用户"><a href="#检查是否存在注册时间在2016年-4月-15号之后的用户" class="headerlink" title="检查是否存在注册时间在2016年-4月-15号之后的用户"></a>检查是否存在注册时间在2016年-4月-15号之后的用户</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">df_user = pd.read_csv(<span class="string">'data\JData_User.csv'</span>,encoding=<span class="string">'gbk'</span>)</div><div class="line">df_user[<span class="string">'user_reg_tm'</span>]=pd.to_datetime(df_user[<span class="string">'user_reg_tm'</span>])</div><div class="line">df_user.ix[df_user.user_reg_tm  &gt;= <span class="string">'2016-4-15'</span>]</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>-</th>
<th>user_id</th>
<th>age</th>
<th>sex</th>
<th>user_lv_cd</th>
<th>user_reg_tm</th>
</tr>
</thead>
<tbody>
<tr>
<td>7457</td>
<td>207458</td>
<td>-1</td>
<td>2.0</td>
<td>1</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7463</td>
<td>207464</td>
<td>26-35岁</td>
<td>2.0</td>
<td>2</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7467</td>
<td>207468</td>
<td>36-45岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7472</td>
<td>207473</td>
<td>-1</td>
<td>2.0</td>
<td>1</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7482</td>
<td>207483</td>
<td>26-35岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7492</td>
<td>207493</td>
<td>16-25岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7493</td>
<td>207494</td>
<td>16-25岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7503</td>
<td>207504</td>
<td>16-25岁</td>
<td>2.0</td>
<td>4</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7510</td>
<td>207511</td>
<td>46-55岁</td>
<td>2.0</td>
<td>5</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7512</td>
<td>207513</td>
<td>-1</td>
<td>2.0</td>
<td>1</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7518</td>
<td>207519</td>
<td>26-35岁</td>
<td>2.0</td>
<td>2</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7521</td>
<td>207522</td>
<td>26-35岁</td>
<td>0.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7525</td>
<td>207526</td>
<td>-1</td>
<td>2.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7533</td>
<td>207534</td>
<td>-1</td>
<td>2.0</td>
<td>1</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7543</td>
<td>207544</td>
<td>26-35岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7544</td>
<td>207545</td>
<td>-1</td>
<td>2.0</td>
<td>1</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7551</td>
<td>207552</td>
<td>26-35岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>7553</td>
<td>207554</td>
<td>16-25岁</td>
<td>2.0</td>
<td>4</td>
<td>2016-04-15</td>
</tr>
<tr>
<td>8545</td>
<td>208546</td>
<td>16-25岁</td>
<td>0.0</td>
<td>2</td>
<td>2016-04-29</td>
</tr>
<tr>
<td>9394</td>
<td>209395</td>
<td>16-25岁</td>
<td>1.0</td>
<td>2</td>
<td>2016-05-11</td>
</tr>
<tr>
<td>10362</td>
<td>210363</td>
<td>56岁以上</td>
<td>2.0</td>
<td>2</td>
<td>2016-05-24</td>
</tr>
<tr>
<td>10367</td>
<td>210368</td>
<td>-1</td>
<td>2.0</td>
<td>1</td>
<td>2016-05-24</td>
</tr>
<tr>
<td>11019</td>
<td>211020</td>
<td>36-45岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-06-06</td>
</tr>
<tr>
<td>12014</td>
<td>212015</td>
<td>36-45岁</td>
<td>2.0</td>
<td>2</td>
<td>2016-07-05</td>
</tr>
<tr>
<td>13850</td>
<td>213851</td>
<td>26-35岁</td>
<td>2.0</td>
<td>3</td>
<td>2016-09-11</td>
</tr>
<tr>
<td>14542</td>
<td>214543</td>
<td>-1</td>
<td>2.0</td>
<td>1</td>
<td>2016-10-05</td>
</tr>
<tr>
<td>16746</td>
<td>216747</td>
<td>16-25岁</td>
<td>2.0</td>
<td>1</td>
<td>2016-11-25</td>
</tr>
</tbody>
</table>
<p>由于注册时间是京东系统错误造成，如果行为数据中没有在4月15号之后的数据的话，那么说明这些用户还是正常用户，并不需要删除。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df_month = pd.read_csv(<span class="string">'data\JData_Action_201604.csv'</span>)</div><div class="line">df_month[<span class="string">'time'</span>] = pd.to_datetime(df_month[<span class="string">'time'</span>])</div><div class="line">df_month.ix[df_month.time &gt;= <span class="string">'2016-4-16'</span>]</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>-</th>
<th>user_id</th>
<th>sku_id</th>
<th>time</th>
<th>model_id</th>
<th>type</th>
<th>cate</th>
<th>brand</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>结论：说明用户没有异常操作数据，所以这一批用户不删除</p>
<h3 id="行为数据中的user-id为浮点型，进行INT类型转换"><a href="#行为数据中的user-id为浮点型，进行INT类型转换" class="headerlink" title="行为数据中的user_id为浮点型，进行INT类型转换"></a>行为数据中的user_id为浮点型，进行INT类型转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">df_month = pd.read_csv(<span class="string">'data\JData_Action_201602.csv'</span>)</div><div class="line">df_month[<span class="string">'user_id'</span>] = df_month[<span class="string">'user_id'</span>].apply(<span class="keyword">lambda</span> x:int(x))</div><div class="line"><span class="keyword">print</span> df_month[<span class="string">'user_id'</span>].dtype</div><div class="line">df_month.to_csv(<span class="string">'data\JData_Action_201602.csv'</span>,index=<span class="keyword">None</span>)</div><div class="line">df_month = pd.read_csv(<span class="string">'data\JData_Action_201603.csv'</span>)</div><div class="line">df_month[<span class="string">'user_id'</span>] = df_month[<span class="string">'user_id'</span>].apply(<span class="keyword">lambda</span> x:int(x))</div><div class="line"><span class="keyword">print</span> df_month[<span class="string">'user_id'</span>].dtype</div><div class="line">df_month.to_csv(<span class="string">'data\JData_Action_201603.csv'</span>,index=<span class="keyword">None</span>)</div><div class="line">df_month = pd.read_csv(<span class="string">'data\JData_Action_201604.csv'</span>)</div><div class="line">df_month[<span class="string">'user_id'</span>] = df_month[<span class="string">'user_id'</span>].apply(<span class="keyword">lambda</span> x:int(x))</div><div class="line"><span class="keyword">print</span> df_month[<span class="string">'user_id'</span>].dtype</div><div class="line">df_month.to_csv(<span class="string">'data\JData_Action_201604.csv'</span>,index=<span class="keyword">None</span>)</div></pre></td></tr></table></figure>
<pre><code>int64
int64
int64
</code></pre><h3 id="按照星期对用户购买行为进行分析"><a href="#按照星期对用户购买行为进行分析" class="headerlink" title="按照星期对用户购买行为进行分析"></a>按照星期对用户购买行为进行分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 提取购买(type=4)的行为数据</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_from_action_data</span><span class="params">(fname, chunk_size=<span class="number">100000</span>)</span>:</span></div><div class="line">    reader = pd.read_csv(fname, header=<span class="number">0</span>, iterator=<span class="keyword">True</span>)</div><div class="line">    chunks = []</div><div class="line">    loop = <span class="keyword">True</span></div><div class="line">    <span class="keyword">while</span> loop:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            chunk = reader.get_chunk(chunk_size)[</div><div class="line">                [<span class="string">"user_id"</span>, <span class="string">"sku_id"</span>, <span class="string">"type"</span>, <span class="string">"time"</span>]]</div><div class="line">            chunks.append(chunk)</div><div class="line">        <span class="keyword">except</span> StopIteration:</div><div class="line">            loop = <span class="keyword">False</span></div><div class="line">            print(<span class="string">"Iteration is stopped"</span>)</div><div class="line"></div><div class="line">    df_ac = pd.concat(chunks, ignore_index=<span class="keyword">True</span>)</div><div class="line">    <span class="comment"># type=4,为购买</span></div><div class="line">    df_ac = df_ac[df_ac[<span class="string">'type'</span>] == <span class="number">4</span>]</div><div class="line"></div><div class="line">    <span class="keyword">return</span> df_ac[[<span class="string">"user_id"</span>, <span class="string">"sku_id"</span>, <span class="string">"time"</span>]]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df_ac = []</div><div class="line">df_ac.append(get_from_action_data(fname=ACTION_201602_FILE))</div><div class="line">df_ac.append(get_from_action_data(fname=ACTION_201603_FILE))</div><div class="line">df_ac.append(get_from_action_data(fname=ACTION_201604_FILE))</div><div class="line">df_ac = pd.concat(df_ac, ignore_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<pre><code>Iteration is stopped
Iteration is stopped
Iteration is stopped
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(df_ac.dtypes)</div></pre></td></tr></table></figure>
<pre><code>user_id     int64
sku_id      int64
time       object
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将time字段转换为datetime类型</span></div><div class="line">df_ac[<span class="string">'time'</span>] = pd.to_datetime(df_ac[<span class="string">'time'</span>])</div><div class="line"></div><div class="line"><span class="comment"># 使用lambda匿名函数将时间time转换为星期(周一为1, 周日为７)</span></div><div class="line">df_ac[<span class="string">'time'</span>] = df_ac[<span class="string">'time'</span>].apply(<span class="keyword">lambda</span> x: x.weekday() + <span class="number">1</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 周一到周日每天购买用户个数</span></div><div class="line">df_user = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'user_id'</span>].nunique()</div><div class="line">df_user = df_user.to_frame().reset_index()</div><div class="line">df_user.columns = [<span class="string">'weekday'</span>, <span class="string">'user_num'</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 周一到周日每天购买商品个数</span></div><div class="line">df_item = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'sku_id'</span>].nunique()</div><div class="line">df_item = df_item.to_frame().reset_index()</div><div class="line">df_item.columns = [<span class="string">'weekday'</span>, <span class="string">'item_num'</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 周一到周日每天购买记录个数</span></div><div class="line">df_ui = df_ac.groupby(<span class="string">'time'</span>, as_index=<span class="keyword">False</span>).size()</div><div class="line">df_ui = df_ui.to_frame().reset_index()</div><div class="line">df_ui.columns = [<span class="string">'weekday'</span>, <span class="string">'user_item_num'</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 条形宽度</span></div><div class="line">bar_width = <span class="number">0.2</span></div><div class="line"><span class="comment"># 透明度</span></div><div class="line">opacity = <span class="number">0.4</span></div><div class="line"></div><div class="line">plt.bar(df_user[<span class="string">'weekday'</span>], df_user[<span class="string">'user_num'</span>], bar_width, </div><div class="line">        alpha=opacity, color=<span class="string">'c'</span>, label=<span class="string">'user'</span>)</div><div class="line">plt.bar(df_item[<span class="string">'weekday'</span>]+bar_width, df_item[<span class="string">'item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'g'</span>, label=<span class="string">'item'</span>)</div><div class="line">plt.bar(df_ui[<span class="string">'weekday'</span>]+bar_width*<span class="number">2</span>, df_ui[<span class="string">'user_item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'m'</span>, label=<span class="string">'user_item'</span>)</div><div class="line"></div><div class="line">plt.xlabel(<span class="string">'weekday'</span>)</div><div class="line">plt.ylabel(<span class="string">'number'</span>)</div><div class="line">plt.title(<span class="string">'A Week Purchase Table'</span>)</div><div class="line">plt.xticks(df_user[<span class="string">'weekday'</span>] + bar_width * <span class="number">3</span> / <span class="number">2.</span>, (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>))</div><div class="line">plt.tight_layout() </div><div class="line">plt.legend(prop=&#123;<span class="string">'size'</span>:<span class="number">10</span>&#125;)</div></pre></td></tr></table></figure>
<p><img src="/materials/img/JData/week_purchase.png" alt="week_purchase"></p>
<p>分析：周六，周日购买量较少</p>
<h3 id="一个月中各天购买量"><a href="#一个月中各天购买量" class="headerlink" title="一个月中各天购买量"></a>一个月中各天购买量</h3><h4 id="2016年2月"><a href="#2016年2月" class="headerlink" title="2016年2月"></a>2016年2月</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df_ac = get_from_action_data(fname=ACTION_201602_FILE)</div><div class="line"></div><div class="line"><span class="comment"># 将time字段转换为datetime类型并使用lambda匿名函数将时间time转换为天</span></div><div class="line">df_ac[<span class="string">'time'</span>] = pd.to_datetime(df_ac[<span class="string">'time'</span>]).apply(<span class="keyword">lambda</span> x: x.day)</div></pre></td></tr></table></figure>
<pre><code>Iteration is stopped
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">df_user = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'user_id'</span>].nunique()</div><div class="line">df_user = df_user.to_frame().reset_index()</div><div class="line">df_user.columns = [<span class="string">'day'</span>, <span class="string">'user_num'</span>]</div><div class="line"></div><div class="line">df_item = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'sku_id'</span>].nunique()</div><div class="line">df_item = df_item.to_frame().reset_index()</div><div class="line">df_item.columns = [<span class="string">'day'</span>, <span class="string">'item_num'</span>]</div><div class="line"></div><div class="line">df_ui = df_ac.groupby(<span class="string">'time'</span>, as_index=<span class="keyword">False</span>).size()</div><div class="line">df_ui = df_ui.to_frame().reset_index()</div><div class="line">df_ui.columns = [<span class="string">'day'</span>, <span class="string">'user_item_num'</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 条形宽度</span></div><div class="line">bar_width = <span class="number">0.2</span></div><div class="line"><span class="comment"># 透明度</span></div><div class="line">opacity = <span class="number">0.4</span></div><div class="line"><span class="comment"># 天数</span></div><div class="line">day_range = range(<span class="number">1</span>,len(df_user[<span class="string">'day'</span>]) + <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"><span class="comment"># 设置图片大小</span></div><div class="line">plt.figure(figsize=(<span class="number">14</span>,<span class="number">10</span>))</div><div class="line"></div><div class="line">plt.bar(df_user[<span class="string">'day'</span>], df_user[<span class="string">'user_num'</span>], bar_width, </div><div class="line">        alpha=opacity, color=<span class="string">'c'</span>, label=<span class="string">'user'</span>)</div><div class="line">plt.bar(df_item[<span class="string">'day'</span>]+bar_width, df_item[<span class="string">'item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'g'</span>, label=<span class="string">'item'</span>)</div><div class="line">plt.bar(df_ui[<span class="string">'day'</span>]+bar_width*<span class="number">2</span>, df_ui[<span class="string">'user_item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'m'</span>, label=<span class="string">'user_item'</span>)</div><div class="line"></div><div class="line">plt.xlabel(<span class="string">'day'</span>)</div><div class="line">plt.ylabel(<span class="string">'number'</span>)</div><div class="line">plt.title(<span class="string">'February Purchase Table'</span>)</div><div class="line">plt.xticks(df_user[<span class="string">'day'</span>] + bar_width * <span class="number">3</span> / <span class="number">2.</span>, day_range)</div><div class="line"><span class="comment"># plt.ylim(0, 80)</span></div><div class="line">plt.tight_layout() </div><div class="line">plt.legend(prop=&#123;<span class="string">'size'</span>:<span class="number">9</span>&#125;)</div></pre></td></tr></table></figure>
<p><img src="/materials/img/JData/month_2_buy.png" alt="month_2_buy"></p>
<p>分析： 2月份5,6,7,8,9,10 这几天购买量非常少，原因可能是中国农历春节，快递不营业</p>
<h4 id="2016年3月"><a href="#2016年3月" class="headerlink" title="2016年3月"></a>2016年3月</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df_ac = get_from_action_data(fname=ACTION_201603_FILE)</div><div class="line"></div><div class="line"><span class="comment"># 将time字段转换为datetime类型并使用lambda匿名函数将时间time转换为天</span></div><div class="line">df_ac[<span class="string">'time'</span>] = pd.to_datetime(df_ac[<span class="string">'time'</span>]).apply(<span class="keyword">lambda</span> x: x.day)</div></pre></td></tr></table></figure>
<pre><code>Iteration is stopped
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">df_user = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'user_id'</span>].nunique()</div><div class="line">df_user = df_user.to_frame().reset_index()</div><div class="line">df_user.columns = [<span class="string">'day'</span>, <span class="string">'user_num'</span>]</div><div class="line"></div><div class="line">df_item = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'sku_id'</span>].nunique()</div><div class="line">df_item = df_item.to_frame().reset_index()</div><div class="line">df_item.columns = [<span class="string">'day'</span>, <span class="string">'item_num'</span>]</div><div class="line"></div><div class="line">df_ui = df_ac.groupby(<span class="string">'time'</span>, as_index=<span class="keyword">False</span>).size()</div><div class="line">df_ui = df_ui.to_frame().reset_index()</div><div class="line">df_ui.columns = [<span class="string">'day'</span>, <span class="string">'user_item_num'</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 条形宽度</span></div><div class="line">bar_width = <span class="number">0.2</span></div><div class="line"><span class="comment"># 透明度</span></div><div class="line">opacity = <span class="number">0.4</span></div><div class="line"><span class="comment"># 天数</span></div><div class="line">day_range = range(<span class="number">1</span>,len(df_user[<span class="string">'day'</span>]) + <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"><span class="comment"># 设置图片大小</span></div><div class="line">plt.figure(figsize=(<span class="number">14</span>,<span class="number">10</span>))</div><div class="line"></div><div class="line">plt.bar(df_user[<span class="string">'day'</span>], df_user[<span class="string">'user_num'</span>], bar_width, </div><div class="line">        alpha=opacity, color=<span class="string">'c'</span>, label=<span class="string">'user'</span>)</div><div class="line">plt.bar(df_item[<span class="string">'day'</span>]+bar_width, df_item[<span class="string">'item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'g'</span>, label=<span class="string">'item'</span>)</div><div class="line">plt.bar(df_ui[<span class="string">'day'</span>]+bar_width*<span class="number">2</span>, df_ui[<span class="string">'user_item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'m'</span>, label=<span class="string">'user_item'</span>)</div><div class="line"></div><div class="line">plt.xlabel(<span class="string">'day'</span>)</div><div class="line">plt.ylabel(<span class="string">'number'</span>)</div><div class="line">plt.title(<span class="string">'March Purchase Table'</span>)</div><div class="line">plt.xticks(df_user[<span class="string">'day'</span>] + bar_width * <span class="number">3</span> / <span class="number">2.</span>, day_range)</div><div class="line"><span class="comment"># plt.ylim(0, 80)</span></div><div class="line">plt.tight_layout() </div><div class="line">plt.legend(prop=&#123;<span class="string">'size'</span>:<span class="number">9</span>&#125;)</div></pre></td></tr></table></figure>
<p><img src="/materials/img/JData/month_3_buy.png" alt="month_3_buy"></p>
<p>分析：3月份14,15,16不知名节日，造成购物量剧增，总体来看，购物记录多于2月份</p>
<h4 id="2016年4月"><a href="#2016年4月" class="headerlink" title="2016年4月"></a>2016年4月</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df_ac = get_from_action_data(fname=ACTION_201604_FILE)</div><div class="line"></div><div class="line"><span class="comment"># 将time字段转换为datetime类型并使用lambda匿名函数将时间time转换为天</span></div><div class="line">df_ac[<span class="string">'time'</span>] = pd.to_datetime(df_ac[<span class="string">'time'</span>]).apply(<span class="keyword">lambda</span> x: x.day)</div></pre></td></tr></table></figure>
<pre><code>Iteration is stopped
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">df_user = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'user_id'</span>].nunique()</div><div class="line">df_user = df_user.to_frame().reset_index()</div><div class="line">df_user.columns = [<span class="string">'day'</span>, <span class="string">'user_num'</span>]</div><div class="line"></div><div class="line">df_item = df_ac.groupby(<span class="string">'time'</span>)[<span class="string">'sku_id'</span>].nunique()</div><div class="line">df_item = df_item.to_frame().reset_index()</div><div class="line">df_item.columns = [<span class="string">'day'</span>, <span class="string">'item_num'</span>]</div><div class="line"></div><div class="line">df_ui = df_ac.groupby(<span class="string">'time'</span>, as_index=<span class="keyword">False</span>).size()</div><div class="line">df_ui = df_ui.to_frame().reset_index()</div><div class="line">df_ui.columns = [<span class="string">'day'</span>, <span class="string">'user_item_num'</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 条形宽度</span></div><div class="line">bar_width = <span class="number">0.2</span></div><div class="line"><span class="comment"># 透明度</span></div><div class="line">opacity = <span class="number">0.4</span></div><div class="line"><span class="comment"># 天数</span></div><div class="line">day_range = range(<span class="number">1</span>,len(df_user[<span class="string">'day'</span>]) + <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"><span class="comment"># 设置图片大小</span></div><div class="line">plt.figure(figsize=(<span class="number">14</span>,<span class="number">10</span>))</div><div class="line"></div><div class="line">plt.bar(df_user[<span class="string">'day'</span>], df_user[<span class="string">'user_num'</span>], bar_width, </div><div class="line">        alpha=opacity, color=<span class="string">'c'</span>, label=<span class="string">'user'</span>)</div><div class="line">plt.bar(df_item[<span class="string">'day'</span>]+bar_width, df_item[<span class="string">'item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'g'</span>, label=<span class="string">'item'</span>)</div><div class="line">plt.bar(df_ui[<span class="string">'day'</span>]+bar_width*<span class="number">2</span>, df_ui[<span class="string">'user_item_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'m'</span>, label=<span class="string">'user_item'</span>)</div><div class="line"></div><div class="line">plt.xlabel(<span class="string">'day'</span>)</div><div class="line">plt.ylabel(<span class="string">'number'</span>)</div><div class="line">plt.title(<span class="string">'April Purchase Table'</span>)</div><div class="line">plt.xticks(df_user[<span class="string">'day'</span>] + bar_width * <span class="number">3</span> / <span class="number">2.</span>, day_range)</div><div class="line"><span class="comment"># plt.ylim(0, 80)</span></div><div class="line">plt.tight_layout() </div><div class="line">plt.legend(prop=&#123;<span class="string">'size'</span>:<span class="number">9</span>&#125;)</div></pre></td></tr></table></figure>
<p><img src="/materials/img/JData/month_4_buy.png" alt="month_4_buy"></p>
<p>分析：似乎每个月中旬都有较强的购物欲望？</p>
<h3 id="商品分类别销售统计"><a href="#商品分类别销售统计" class="headerlink" title="商品分类别销售统计"></a>商品分类别销售统计</h3><h4 id="周一到周日各商品类别销售情况"><a href="#周一到周日各商品类别销售情况" class="headerlink" title="周一到周日各商品类别销售情况"></a>周一到周日各商品类别销售情况</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 从行为记录中提取商品类别数据</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_from_action_data</span><span class="params">(fname, chunk_size=<span class="number">100000</span>)</span>:</span></div><div class="line">    reader = pd.read_csv(fname, header=<span class="number">0</span>, iterator=<span class="keyword">True</span>)</div><div class="line">    chunks = []</div><div class="line">    loop = <span class="keyword">True</span></div><div class="line">    <span class="keyword">while</span> loop:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            chunk = reader.get_chunk(chunk_size)[</div><div class="line">                [<span class="string">"cate"</span>, <span class="string">"brand"</span>, <span class="string">"type"</span>, <span class="string">"time"</span>]]</div><div class="line">            chunks.append(chunk)</div><div class="line">        <span class="keyword">except</span> StopIteration:</div><div class="line">            loop = <span class="keyword">False</span></div><div class="line">            print(<span class="string">"Iteration is stopped"</span>)</div><div class="line"></div><div class="line">    df_ac = pd.concat(chunks, ignore_index=<span class="keyword">True</span>)</div><div class="line">    <span class="comment"># type=4,为购买</span></div><div class="line">    df_ac = df_ac[df_ac[<span class="string">'type'</span>] == <span class="number">4</span>]</div><div class="line"></div><div class="line">    <span class="keyword">return</span> df_ac[[<span class="string">"cate"</span>, <span class="string">"brand"</span>, <span class="string">"type"</span>, <span class="string">"time"</span>]]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df_ac = []</div><div class="line">df_ac.append(get_from_action_data(fname=ACTION_201602_FILE))</div><div class="line">df_ac.append(get_from_action_data(fname=ACTION_201603_FILE))</div><div class="line">df_ac.append(get_from_action_data(fname=ACTION_201604_FILE))</div><div class="line">df_ac = pd.concat(df_ac, ignore_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<pre><code>Iteration is stopped
Iteration is stopped
Iteration is stopped
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 将time字段转换为datetime类型</span></div><div class="line">df_ac[<span class="string">'time'</span>] = pd.to_datetime(df_ac[<span class="string">'time'</span>])</div><div class="line"></div><div class="line"><span class="comment"># 使用lambda匿名函数将时间time转换为星期(周一为1, 周日为７)</span></div><div class="line">df_ac[<span class="string">'time'</span>] = df_ac[<span class="string">'time'</span>].apply(<span class="keyword">lambda</span> x: x.weekday() + <span class="number">1</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 观察有几个类别商品</span></div><div class="line">df_ac.groupby(df_ac[<span class="string">'cate'</span>]).count()</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>cate</th>
<th>cate</th>
<th>brand</th>
<th>type</th>
<th>time</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>9326</td>
<td>9326</td>
<td>9326</td>
<td>9326</td>
</tr>
<tr>
<td>5</td>
<td>8138</td>
<td>8138</td>
<td>8138</td>
<td>8138</td>
</tr>
<tr>
<td>6</td>
<td>6982</td>
<td>6982</td>
<td>6982</td>
<td>6982</td>
</tr>
<tr>
<td>7</td>
<td>6214</td>
<td>6214</td>
<td>6214</td>
<td>6214</td>
</tr>
<tr>
<td>8</td>
<td>13281</td>
<td>13281</td>
<td>13281</td>
<td>13281</td>
</tr>
<tr>
<td>9</td>
<td>4104</td>
<td>4104</td>
<td>4104</td>
<td>4104</td>
</tr>
<tr>
<td>10</td>
<td>189</td>
<td>189</td>
<td>189</td>
<td>189</td>
</tr>
<tr>
<td>11</td>
<td>18</td>
<td>18</td>
<td>18</td>
<td>18</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 周一到周日每天购买商品类别4的数量统计</span></div><div class="line">df_product = df_ac[<span class="string">'brand'</span>].groupby([df_ac[<span class="string">'time'</span>],df_ac[<span class="string">'cate'</span>]]).count()</div><div class="line">df_product=df_product.unstack()</div><div class="line">df_product.plot(kind=<span class="string">'bar'</span>,title=<span class="string">'Cate Purchase Table in a Week'</span>,figsize=(<span class="number">14</span>,<span class="number">10</span>))</div></pre></td></tr></table></figure>
<p><img src="/materials/img/JData/week_cate_buy.png" alt="week_cate_buy"></p>
<p>分析：星期二买类别8的最多，星期天最少。</p>
<h4 id="每月各类商品销售情况（只关注商品8）"><a href="#每月各类商品销售情况（只关注商品8）" class="headerlink" title="每月各类商品销售情况（只关注商品8）"></a>每月各类商品销售情况（只关注商品8）</h4><h5 id="2016年2，3，4月"><a href="#2016年2，3，4月" class="headerlink" title="2016年2，3，4月"></a>2016年2，3，4月</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">df_ac2 = get_from_action_data(fname=ACTION_201602_FILE)</div><div class="line"></div><div class="line"><span class="comment"># 将time字段转换为datetime类型并使用lambda匿名函数将时间time转换为天</span></div><div class="line">df_ac2[<span class="string">'time'</span>] = pd.to_datetime(df_ac2[<span class="string">'time'</span>]).apply(<span class="keyword">lambda</span> x: x.day)</div><div class="line">df_ac3 = get_from_action_data(fname=ACTION_201603_FILE)</div><div class="line"></div><div class="line"><span class="comment"># 将time字段转换为datetime类型并使用lambda匿名函数将时间time转换为天</span></div><div class="line">df_ac3[<span class="string">'time'</span>] = pd.to_datetime(df_ac3[<span class="string">'time'</span>]).apply(<span class="keyword">lambda</span> x: x.day)</div><div class="line">df_ac4 = get_from_action_data(fname=ACTION_201604_FILE)</div><div class="line"></div><div class="line"><span class="comment"># 将time字段转换为datetime类型并使用lambda匿名函数将时间time转换为天</span></div><div class="line">df_ac4[<span class="string">'time'</span>] = pd.to_datetime(df_ac4[<span class="string">'time'</span>]).apply(<span class="keyword">lambda</span> x: x.day)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">dc_cate2 = df_ac2[df_ac2[<span class="string">'cate'</span>]==<span class="number">8</span>]</div><div class="line">dc_cate2 = dc_cate2[<span class="string">'brand'</span>].groupby(dc_cate2[<span class="string">'time'</span>]).count()</div><div class="line">dc_cate2 = dc_cate2.to_frame().reset_index()</div><div class="line">dc_cate2.columns = [<span class="string">'day'</span>, <span class="string">'product_num'</span>]</div><div class="line"></div><div class="line">dc_cate3 = df_ac3[df_ac3[<span class="string">'cate'</span>]==<span class="number">8</span>]</div><div class="line">dc_cate3 = dc_cate3[<span class="string">'brand'</span>].groupby(dc_cate3[<span class="string">'time'</span>]).count()</div><div class="line">dc_cate3 = dc_cate3.to_frame().reset_index()</div><div class="line">dc_cate3.columns = [<span class="string">'day'</span>, <span class="string">'product_num'</span>]</div><div class="line"></div><div class="line">dc_cate4 = df_ac4[df_ac4[<span class="string">'cate'</span>]==<span class="number">8</span>]</div><div class="line">dc_cate4 = dc_cate4[<span class="string">'brand'</span>].groupby(dc_cate4[<span class="string">'time'</span>]).count()</div><div class="line">dc_cate4 = dc_cate4.to_frame().reset_index()</div><div class="line">dc_cate4.columns = [<span class="string">'day'</span>, <span class="string">'product_num'</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 条形宽度</span></div><div class="line">bar_width = <span class="number">0.2</span></div><div class="line"><span class="comment"># 透明度</span></div><div class="line">opacity = <span class="number">0.4</span></div><div class="line"><span class="comment"># 天数</span></div><div class="line">day_range = range(<span class="number">1</span>,len(dc_cate3[<span class="string">'day'</span>]) + <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"><span class="comment"># 设置图片大小</span></div><div class="line">plt.figure(figsize=(<span class="number">14</span>,<span class="number">10</span>))</div><div class="line"></div><div class="line">plt.bar(dc_cate2[<span class="string">'day'</span>], dc_cate2[<span class="string">'product_num'</span>], bar_width, </div><div class="line">        alpha=opacity, color=<span class="string">'c'</span>, label=<span class="string">'February'</span>)</div><div class="line">plt.bar(dc_cate3[<span class="string">'day'</span>]+bar_width, dc_cate3[<span class="string">'product_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'g'</span>, label=<span class="string">'March'</span>)</div><div class="line">plt.bar(dc_cate4[<span class="string">'day'</span>]+bar_width*<span class="number">2</span>, dc_cate4[<span class="string">'product_num'</span>], </div><div class="line">        bar_width, alpha=opacity, color=<span class="string">'m'</span>, label=<span class="string">'April'</span>)</div><div class="line"></div><div class="line">plt.xlabel(<span class="string">'day'</span>)</div><div class="line">plt.ylabel(<span class="string">'number'</span>)</div><div class="line">plt.title(<span class="string">'Cate-8 Purchase Table'</span>)</div><div class="line">plt.xticks(dc_cate3[<span class="string">'day'</span>] + bar_width * <span class="number">3</span> / <span class="number">2.</span>, day_range)</div><div class="line"><span class="comment"># plt.ylim(0, 80)</span></div><div class="line">plt.tight_layout() </div><div class="line">plt.legend(prop=&#123;<span class="string">'size'</span>:<span class="number">9</span>&#125;)</div></pre></td></tr></table></figure>
<p><img src="/materials/img/JData/month_cate_buy.png" alt="month_cate_buy"></p>
<p>分析：2月份对类别8商品的购买普遍偏低，3，4月份普遍偏高，3月15日购买极其多！可以对比3月份的销售记录，发现类别8将近占了3月15日总销售的一半！同时发现，3,4月份类别8销售记录在前半个月特别相似，除了4月8号，9号和3月15号。</p>
<h2 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">comment_date = [</div><div class="line">    <span class="string">"2016-02-01"</span>, <span class="string">"2016-02-08"</span>, <span class="string">"2016-02-15"</span>, <span class="string">"2016-02-22"</span>, <span class="string">"2016-02-29"</span>,</div><div class="line">    <span class="string">"2016-03-07"</span>, <span class="string">"2016-03-14"</span>, <span class="string">"2016-03-21"</span>, <span class="string">"2016-03-28"</span>, <span class="string">"2016-04-04"</span>,</div><div class="line">    <span class="string">"2016-04-11"</span>, <span class="string">"2016-04-15"</span></div><div class="line">]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_actions_1</span><span class="params">()</span>:</span></div><div class="line">    action = pd.read_csv(action_1_path)</div><div class="line">    <span class="keyword">return</span> action</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_actions_2</span><span class="params">()</span>:</span></div><div class="line">    action2 = pd.read_csv(action_2_path)</div><div class="line">    <span class="keyword">return</span> action2</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_actions_3</span><span class="params">()</span>:</span></div><div class="line">    action3 = pd.read_csv(action_3_path)</div><div class="line">    <span class="keyword">return</span> action3</div><div class="line"><span class="comment"># 读取并拼接所有行为记录文件</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all_action</span><span class="params">()</span>:</span></div><div class="line">    action_1 = get_actions_1()</div><div class="line">    action_2 = get_actions_2()</div><div class="line">    action_3 = get_actions_3()</div><div class="line">    actions = pd.concat([action_1, action_2, action_3]) <span class="comment"># type: pd.DataFrame</span></div><div class="line"><span class="comment">#     actions = pd.read_csv(action_path)</span></div><div class="line">    <span class="keyword">return</span> actions</div><div class="line"></div><div class="line"><span class="comment"># 获取某个时间段的行为记录</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_actions</span><span class="params">(start_date, end_date, all_actions)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    :param start_date:</div><div class="line">    :param end_date:</div><div class="line">    :return: actions: pd.Dataframe</div><div class="line">    """</div><div class="line">    actions = all_actions[(all_actions.time &gt;= start_date) &amp; (all_actions.time &lt; end_date)].copy()</div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<h3 id="用户特征"><a href="#用户特征" class="headerlink" title="用户特征"></a>用户特征</h3><h4 id="用户基本特征"><a href="#用户基本特征" class="headerlink" title="用户基本特征"></a>用户基本特征</h4><p>获取基本的用户特征，基于用户本身属性多为类别特征的特点，对age,sex,usr_lv_cd进行独热编码操作，对于用户注册时间暂时不处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> preprocessing</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_basic_user_feat</span><span class="params">()</span>:</span></div><div class="line">    <span class="comment"># 针对年龄的中文字符问题处理，首先是读入的时候编码，填充空值，然后将其数值化，最后独热编码，此外对于sex也进行了数值类型转换</span></div><div class="line">    user = pd.read_csv(user_path, encoding=<span class="string">'gbk'</span>)</div><div class="line"><span class="comment">#     user['age'].fillna('-1', inplace=True)</span></div><div class="line"><span class="comment">#     user['sex'].fillna(2, inplace=True)</span></div><div class="line">    user[<span class="string">'sex'</span>] = user[<span class="string">'sex'</span>].astype(int)    </div><div class="line">    user[<span class="string">'age'</span>] = user[<span class="string">'age'</span>].astype(unicode)</div><div class="line">    le = preprocessing.LabelEncoder()    </div><div class="line">    age_df = le.fit_transform(user[<span class="string">'age'</span>])</div><div class="line"><span class="comment">#     print list(le.classes_)</span></div><div class="line"></div><div class="line">    age_df = pd.get_dummies(age_df, prefix=<span class="string">'age'</span>)</div><div class="line">    sex_df = pd.get_dummies(user[<span class="string">'sex'</span>], prefix=<span class="string">'sex'</span>)</div><div class="line">    user_lv_df = pd.get_dummies(user[<span class="string">'user_lv_cd'</span>], prefix=<span class="string">'user_lv_cd'</span>)</div><div class="line">    user = pd.concat([user[<span class="string">'user_id'</span>], age_df, sex_df, user_lv_df], axis=<span class="number">1</span>)</div><div class="line">    <span class="keyword">return</span> user</div></pre></td></tr></table></figure>
<h3 id="商品特征"><a href="#商品特征" class="headerlink" title="商品特征"></a>商品特征</h3><h4 id="商品基本特征"><a href="#商品基本特征" class="headerlink" title="商品基本特征"></a>商品基本特征</h4><p>根据商品文件获取基本的特征，针对属性a1,a2,a3进行独热编码，商品类别和品牌直接作为特征</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_basic_product_feat</span><span class="params">()</span>:</span></div><div class="line">    product = pd.read_csv(product_path)</div><div class="line">    attr1_df = pd.get_dummies(product[<span class="string">"a1"</span>], prefix=<span class="string">"a1"</span>)</div><div class="line">    attr2_df = pd.get_dummies(product[<span class="string">"a2"</span>], prefix=<span class="string">"a2"</span>)</div><div class="line">    attr3_df = pd.get_dummies(product[<span class="string">"a3"</span>], prefix=<span class="string">"a3"</span>)</div><div class="line">    product = pd.concat([product[[<span class="string">'sku_id'</span>, <span class="string">'cate'</span>, <span class="string">'brand'</span>]], attr1_df, attr2_df, attr3_df], axis=<span class="number">1</span>)</div><div class="line">    <span class="keyword">return</span> product</div></pre></td></tr></table></figure>
<h3 id="评论特征"><a href="#评论特征" class="headerlink" title="评论特征"></a>评论特征</h3><ul>
<li>分时间段</li>
<li>对评论数进行独热编码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_comments_product_feat</span><span class="params">(end_date)</span>:</span></div><div class="line">    comments = pd.read_csv(comment_path)</div><div class="line">    comment_date_end = end_date</div><div class="line">    comment_date_begin = comment_date[<span class="number">0</span>]</div><div class="line">    <span class="keyword">for</span> date <span class="keyword">in</span> reversed(comment_date):</div><div class="line">        <span class="keyword">if</span> date &lt; comment_date_end:</div><div class="line">            comment_date_begin = date</div><div class="line">            <span class="keyword">break</span></div><div class="line">    comments = comments[comments.dt==comment_date_begin]</div><div class="line">    df = pd.get_dummies(comments[<span class="string">'comment_num'</span>], prefix=<span class="string">'comment_num'</span>)</div><div class="line">    <span class="comment"># 为了防止某个时间段不具备评论数为0的情况（测试集出现过这种情况）</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">5</span>):</div><div class="line">        <span class="keyword">if</span> <span class="string">'comment_num_'</span> + str(i) <span class="keyword">not</span> <span class="keyword">in</span> df.columns:</div><div class="line">            df[<span class="string">'comment_num_'</span> + str(i)] = <span class="number">0</span></div><div class="line">    df = df[[<span class="string">'comment_num_0'</span>, <span class="string">'comment_num_1'</span>, <span class="string">'comment_num_2'</span>, <span class="string">'comment_num_3'</span>, <span class="string">'comment_num_4'</span>]]</div><div class="line">    </div><div class="line">    comments = pd.concat([comments, df], axis=<span class="number">1</span>) <span class="comment"># type: pd.DataFrame</span></div><div class="line">        <span class="comment">#del comments['dt']</span></div><div class="line">        <span class="comment">#del comments['comment_num']</span></div><div class="line">    comments = comments[[<span class="string">'sku_id'</span>, <span class="string">'has_bad_comment'</span>, <span class="string">'bad_comment_rate'</span>,<span class="string">'comment_num_0'</span>, <span class="string">'comment_num_1'</span>, </div><div class="line">                         <span class="string">'comment_num_2'</span>, <span class="string">'comment_num_3'</span>, <span class="string">'comment_num_4'</span>]]</div><div class="line">    <span class="keyword">return</span> comments</div></pre></td></tr></table></figure>
<h3 id="行为特征"><a href="#行为特征" class="headerlink" title="行为特征"></a>行为特征</h3><ul>
<li>分时间段</li>
<li>对行为类别进行独热编码</li>
<li>分别按照用户-类别行为分组和用户-类别-商品行为分组统计，然后计算<ul>
<li>用户对同类别下其他商品的行为计数</li>
<li>针对用户对同类别下目标商品的行为计数与该时间段的行为均值作差</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_action_feat</span><span class="params">(start_date, end_date, all_actions, i)</span>:</span></div><div class="line">    actions = get_actions(start_date, end_date, all_actions)</div><div class="line">    actions = actions[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'cate'</span>,<span class="string">'type'</span>]]</div><div class="line">    <span class="comment"># 不同时间累积的行为计数（3,5,7,10,15,21,30）</span></div><div class="line">    df = pd.get_dummies(actions[<span class="string">'type'</span>], prefix=<span class="string">'action_before_%s'</span> %i)</div><div class="line">    before_date = <span class="string">'action_before_%s'</span> %i</div><div class="line">    actions = pd.concat([actions, df], axis=<span class="number">1</span>)  <span class="comment"># type: pd.DataFrame</span></div><div class="line">    <span class="comment"># 分组统计，用户-类别-商品,不同用户对不同类别下商品的行为计数</span></div><div class="line">    actions = actions.groupby([<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>,<span class="string">'cate'</span>], as_index=<span class="keyword">False</span>).sum()</div><div class="line">    <span class="comment"># 分组统计，用户-类别，不同用户对不同商品类别的行为计数</span></div><div class="line">    user_cate = actions.groupby([<span class="string">'user_id'</span>,<span class="string">'cate'</span>], as_index=<span class="keyword">False</span>).sum()</div><div class="line">    <span class="keyword">del</span> user_cate[<span class="string">'sku_id'</span>]</div><div class="line">    <span class="keyword">del</span> user_cate[<span class="string">'type'</span>]</div><div class="line">    actions = pd.merge(actions, user_cate, how=<span class="string">'left'</span>, on=[<span class="string">'user_id'</span>,<span class="string">'cate'</span>])</div><div class="line">    <span class="comment">#本类别下其他商品点击量</span></div><div class="line">    <span class="comment"># 前述两种分组含有相同名称的不同行为的计数，系统会自动针对名称调整添加后缀,x,y，所以这里作差统计的是同一类别下其他商品的行为计数</span></div><div class="line">    actions[before_date+<span class="string">'_1_y'</span>] = actions[before_date+<span class="string">'_1_y'</span>] - actions[before_date+<span class="string">'_1_x'</span>]</div><div class="line">    actions[before_date+<span class="string">'_2_y'</span>] = actions[before_date+<span class="string">'_2_y'</span>] - actions[before_date+<span class="string">'_2_x'</span>]</div><div class="line">    actions[before_date+<span class="string">'_3_y'</span>] = actions[before_date+<span class="string">'_3_y'</span>] - actions[before_date+<span class="string">'_3_x'</span>]</div><div class="line">    actions[before_date+<span class="string">'_4_y'</span>] = actions[before_date+<span class="string">'_4_y'</span>] - actions[before_date+<span class="string">'_4_x'</span>]</div><div class="line">    actions[before_date+<span class="string">'_5_y'</span>] = actions[before_date+<span class="string">'_5_y'</span>] - actions[before_date+<span class="string">'_5_x'</span>]</div><div class="line">    actions[before_date+<span class="string">'_6_y'</span>] = actions[before_date+<span class="string">'_6_y'</span>] - actions[before_date+<span class="string">'_6_x'</span>]</div><div class="line">    <span class="comment"># 统计用户对不同类别下商品计数与该类别下商品行为计数均值（对时间）的差值</span></div><div class="line">    actions[before_date+<span class="string">'minus_mean_1'</span>] = actions[before_date+<span class="string">'_1_x'</span>] - (actions[before_date+<span class="string">'_1_x'</span>]/i)</div><div class="line">    actions[before_date+<span class="string">'minus_mean_2'</span>] = actions[before_date+<span class="string">'_2_x'</span>] - (actions[before_date+<span class="string">'_2_x'</span>]/i)</div><div class="line">    actions[before_date+<span class="string">'minus_mean_3'</span>] = actions[before_date+<span class="string">'_3_x'</span>] - (actions[before_date+<span class="string">'_3_x'</span>]/i)</div><div class="line">    actions[before_date+<span class="string">'minus_mean_4'</span>] = actions[before_date+<span class="string">'_4_x'</span>] - (actions[before_date+<span class="string">'_4_x'</span>]/i)</div><div class="line">    actions[before_date+<span class="string">'minus_mean_5'</span>] = actions[before_date+<span class="string">'_5_x'</span>] - (actions[before_date+<span class="string">'_5_x'</span>]/i)</div><div class="line">    actions[before_date+<span class="string">'minus_mean_6'</span>] = actions[before_date+<span class="string">'_6_x'</span>] - (actions[before_date+<span class="string">'_6_x'</span>]/i)</div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'type'</span>]</div><div class="line">    <span class="comment"># 保留cate特征</span></div><div class="line"><span class="comment">#     del actions['cate']</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<h3 id="用户-行为"><a href="#用户-行为" class="headerlink" title="用户-行为"></a>用户-行为</h3><h4 id="累积用户特征"><a href="#累积用户特征" class="headerlink" title="累积用户特征"></a>累积用户特征</h4><ul>
<li>分时间段</li>
<li>用户不同行为的<ul>
<li>购买转化率</li>
<li>均值</li>
<li>标准差</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_accumulate_user_feat</span><span class="params">(end_date, all_actions, day)</span>:</span></div><div class="line">    start_date = datetime.strptime(end_date, <span class="string">'%Y-%m-%d'</span>) - timedelta(days=day)</div><div class="line">    start_date = start_date.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">    before_date = <span class="string">'user_action_%s'</span> % day</div><div class="line"></div><div class="line">    feature = [</div><div class="line">        <span class="string">'user_id'</span>, before_date + <span class="string">'_1'</span>, before_date + <span class="string">'_2'</span>, before_date + <span class="string">'_3'</span>,</div><div class="line">        before_date + <span class="string">'_4'</span>, before_date + <span class="string">'_5'</span>, before_date + <span class="string">'_6'</span>,</div><div class="line">        before_date + <span class="string">'_1_ratio'</span>, before_date + <span class="string">'_2_ratio'</span>,</div><div class="line">        before_date + <span class="string">'_3_ratio'</span>, before_date + <span class="string">'_5_ratio'</span>,</div><div class="line">        before_date + <span class="string">'_6_ratio'</span>, before_date + <span class="string">'_1_mean'</span>,</div><div class="line">        before_date + <span class="string">'_2_mean'</span>, before_date + <span class="string">'_3_mean'</span>,</div><div class="line">        before_date + <span class="string">'_4_mean'</span>, before_date + <span class="string">'_5_mean'</span>,</div><div class="line">        before_date + <span class="string">'_6_mean'</span>, before_date + <span class="string">'_1_std'</span>,</div><div class="line">        before_date + <span class="string">'_2_std'</span>, before_date + <span class="string">'_3_std'</span>, before_date + <span class="string">'_4_std'</span>,</div><div class="line">        before_date + <span class="string">'_5_std'</span>, before_date + <span class="string">'_6_std'</span></div><div class="line">    ]</div><div class="line"></div><div class="line">    actions = get_actions(start_date, end_date, all_actions)</div><div class="line">    df = pd.get_dummies(actions[<span class="string">'type'</span>], prefix=before_date)</div><div class="line"></div><div class="line"><span class="comment">#     actions['date'] = pd.to_datetime(actions['time']).apply(lambda x: x.date())</span></div><div class="line"></div><div class="line">    actions = pd.concat([actions[[<span class="string">'user_id'</span>, <span class="string">'date'</span>]], df], axis=<span class="number">1</span>)</div><div class="line">    <span class="comment"># 分组统计，用户不同日期的行为计算标准差</span></div><div class="line">    actions_date = actions.groupby([<span class="string">'user_id'</span>, <span class="string">'date'</span>]).sum()</div><div class="line">    actions_date = actions_date.unstack()</div><div class="line">    actions_date.fillna(<span class="number">0</span>, inplace=<span class="keyword">True</span>)</div><div class="line">    action_1 = np.std(actions_date[before_date + <span class="string">'_1'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_1 = action_1.to_frame()</div><div class="line">    action_1.columns = [before_date + <span class="string">'_1_std'</span>]</div><div class="line">    action_2 = np.std(actions_date[before_date + <span class="string">'_2'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_2 = action_2.to_frame()</div><div class="line">    action_2.columns = [before_date + <span class="string">'_2_std'</span>]</div><div class="line">    action_3 = np.std(actions_date[before_date + <span class="string">'_3'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_3 = action_3.to_frame()</div><div class="line">    action_3.columns = [before_date + <span class="string">'_3_std'</span>]</div><div class="line">    action_4 = np.std(actions_date[before_date + <span class="string">'_4'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_4 = action_4.to_frame()</div><div class="line">    action_4.columns = [before_date + <span class="string">'_4_std'</span>]</div><div class="line">    action_5 = np.std(actions_date[before_date + <span class="string">'_5'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_5 = action_5.to_frame()</div><div class="line">    action_5.columns = [before_date + <span class="string">'_5_std'</span>]</div><div class="line">    action_6 = np.std(actions_date[before_date + <span class="string">'_6'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_6 = action_6.to_frame()</div><div class="line">    action_6.columns = [before_date + <span class="string">'_6_std'</span>]</div><div class="line">    actions_date = pd.concat(</div><div class="line">        [action_1, action_2, action_3, action_4, action_5, action_6], axis=<span class="number">1</span>)</div><div class="line">    actions_date[<span class="string">'user_id'</span>] = actions_date.index</div><div class="line">    <span class="comment"># 分组统计，按用户分组，统计用户各项行为的转化率、均值</span></div><div class="line">    actions = actions.groupby([<span class="string">'user_id'</span>], as_index=<span class="keyword">False</span>).sum()</div><div class="line"><span class="comment">#     days_interal = (datetime.strptime(end_date, '%Y-%m-%d') -</span></div><div class="line"><span class="comment">#                     datetime.strptime(start_date, '%Y-%m-%d')).days</span></div><div class="line">    <span class="comment"># 转化率</span></div><div class="line"><span class="comment">#     actions[before_date + '_1_ratio'] = actions[before_date +</span></div><div class="line"><span class="comment">#                                                 '_4'] / actions[before_date +</span></div><div class="line"><span class="comment">#                                                                 '_1']</span></div><div class="line"><span class="comment">#     actions[before_date + '_2_ratio'] = actions[before_date +</span></div><div class="line"><span class="comment">#                                                 '_4'] / actions[before_date +</span></div><div class="line"><span class="comment">#                                                                 '_2']</span></div><div class="line"><span class="comment">#     actions[before_date + '_3_ratio'] = actions[before_date +</span></div><div class="line"><span class="comment">#                                                 '_4'] / actions[before_date +</span></div><div class="line"><span class="comment">#                                                                 '_3']</span></div><div class="line"><span class="comment">#     actions[before_date + '_5_ratio'] = actions[before_date +</span></div><div class="line"><span class="comment">#                                                 '_4'] / actions[before_date +</span></div><div class="line"><span class="comment">#                                                                 '_5']</span></div><div class="line"><span class="comment">#     actions[before_date + '_6_ratio'] = actions[before_date +</span></div><div class="line"><span class="comment">#                                                 '_4'] / actions[before_date +</span></div><div class="line"><span class="comment">#                                                                 '_6']</span></div><div class="line">    actions[before_date + <span class="string">'_1_ratio'</span>] =  np.log(<span class="number">1</span> + actions[before_date + <span class="string">'_4'</span>]) - np.log(<span class="number">1</span> + actions[before_date +<span class="string">'_1'</span>])</div><div class="line">    actions[before_date + <span class="string">'_2_ratio'</span>] =  np.log(<span class="number">1</span> + actions[before_date + <span class="string">'_4'</span>]) - np.log(<span class="number">1</span> + actions[before_date +<span class="string">'_2'</span>])</div><div class="line">    actions[before_date + <span class="string">'_3_ratio'</span>] =  np.log(<span class="number">1</span> + actions[before_date + <span class="string">'_4'</span>]) - np.log(<span class="number">1</span> + actions[before_date +<span class="string">'_3'</span>])</div><div class="line">    actions[before_date + <span class="string">'_5_ratio'</span>] =  np.log(<span class="number">1</span> + actions[before_date + <span class="string">'_4'</span>]) - np.log(<span class="number">1</span> + actions[before_date +<span class="string">'_5'</span>])</div><div class="line">    actions[before_date + <span class="string">'_6_ratio'</span>] =  np.log(<span class="number">1</span> + actions[before_date + <span class="string">'_4'</span>]) - np.log(<span class="number">1</span> + actions[before_date +<span class="string">'_6'</span>])</div><div class="line">    <span class="comment"># 均值</span></div><div class="line">    actions[before_date + <span class="string">'_1_mean'</span>] = actions[before_date + <span class="string">'_1'</span>] / day</div><div class="line">    actions[before_date + <span class="string">'_2_mean'</span>] = actions[before_date + <span class="string">'_2'</span>] / day</div><div class="line">    actions[before_date + <span class="string">'_3_mean'</span>] = actions[before_date + <span class="string">'_3'</span>] / day</div><div class="line">    actions[before_date + <span class="string">'_4_mean'</span>] = actions[before_date + <span class="string">'_4'</span>] / day</div><div class="line">    actions[before_date + <span class="string">'_5_mean'</span>] = actions[before_date + <span class="string">'_5'</span>] / day</div><div class="line">    actions[before_date + <span class="string">'_6_mean'</span>] = actions[before_date + <span class="string">'_6'</span>] / day</div><div class="line">    actions = pd.merge(actions, actions_date, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    actions = actions[feature]</div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<h4 id="用户近期行为特征"><a href="#用户近期行为特征" class="headerlink" title="用户近期行为特征"></a>用户近期行为特征</h4><p>在上面针对用户进行累积特征提取的基础上，分别提取用户近一个月、近三天的特征，然后提取一个月内用户除去最近三天的行为占据一个月的行为的比重</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_recent_user_feat</span><span class="params">(end_date, all_actions)</span>:</span></div><div class="line">    actions_3 = get_accumulate_user_feat(end_date, all_actions, <span class="number">3</span>)</div><div class="line">    actions_30 = get_accumulate_user_feat(end_date, all_actions, <span class="number">30</span>)</div><div class="line">    actions = pd.merge(actions_3, actions_30, how =<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    <span class="keyword">del</span> actions_3</div><div class="line">    <span class="keyword">del</span> actions_30</div><div class="line">    </div><div class="line">    actions[<span class="string">'recent_action1'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_1'</span>]-actions[<span class="string">'user_action_3_1'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_1'</span>])</div><div class="line">    actions[<span class="string">'recent_action2'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_2'</span>]-actions[<span class="string">'user_action_3_2'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_2'</span>])</div><div class="line">    actions[<span class="string">'recent_action3'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_3'</span>]-actions[<span class="string">'user_action_3_3'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_3'</span>])</div><div class="line">    actions[<span class="string">'recent_action4'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_4'</span>]-actions[<span class="string">'user_action_3_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_4'</span>])</div><div class="line">    actions[<span class="string">'recent_action5'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_5'</span>]-actions[<span class="string">'user_action_3_5'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_5'</span>])</div><div class="line">    actions[<span class="string">'recent_action6'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_6'</span>]-actions[<span class="string">'user_action_3_6'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'user_action_30_6'</span>])</div><div class="line">    </div><div class="line"><span class="comment">#     actions['recent_action1'] = (actions['user_action_30_1']-actions['user_action_3_1'])/actions['user_action_30_1']</span></div><div class="line"><span class="comment">#     actions['recent_action2'] = (actions['user_action_30_2']-actions['user_action_3_2'])/actions['user_action_30_2']</span></div><div class="line"><span class="comment">#     actions['recent_action3'] = (actions['user_action_30_3']-actions['user_action_3_3'])/actions['user_action_30_3']</span></div><div class="line"><span class="comment">#     actions['recent_action4'] = (actions['user_action_30_4']-actions['user_action_3_4'])/actions['user_action_30_4']</span></div><div class="line"><span class="comment">#     actions['recent_action5'] = (actions['user_action_30_5']-actions['user_action_3_5'])/actions['user_action_30_5']</span></div><div class="line"><span class="comment">#     actions['recent_action6'] = (actions['user_action_30_6']-actions['user_action_3_6'])/actions['user_action_30_6']</span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<h4 id="用户对同类别下各种商品的行为"><a href="#用户对同类别下各种商品的行为" class="headerlink" title="用户对同类别下各种商品的行为"></a>用户对同类别下各种商品的行为</h4><ul>
<li>用户对各个类别的各项行为操作统计</li>
<li>用户对各个类别操作行为统计占对所有类别操作行为统计的比重</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#增加了用户对不同类别的交互特征</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user_cate_feature</span><span class="params">(start_date, end_date, all_actions)</span>:</span></div><div class="line">    actions = get_actions(start_date, end_date, all_actions)</div><div class="line">    actions = actions[[<span class="string">'user_id'</span>, <span class="string">'cate'</span>, <span class="string">'type'</span>]]</div><div class="line">    df = pd.get_dummies(actions[<span class="string">'type'</span>], prefix=<span class="string">'type'</span>)</div><div class="line">    actions = pd.concat([actions[[<span class="string">'user_id'</span>, <span class="string">'cate'</span>]], df], axis=<span class="number">1</span>)</div><div class="line">    actions = actions.groupby([<span class="string">'user_id'</span>, <span class="string">'cate'</span>]).sum()</div><div class="line">    actions = actions.unstack()</div><div class="line">    actions.columns = actions.columns.swaplevel(<span class="number">0</span>, <span class="number">1</span>)</div><div class="line">    actions.columns = actions.columns.droplevel()</div><div class="line">    actions.columns = [</div><div class="line">        <span class="string">'cate_4_type1'</span>, <span class="string">'cate_5_type1'</span>, <span class="string">'cate_6_type1'</span>, <span class="string">'cate_7_type1'</span>,</div><div class="line">        <span class="string">'cate_8_type1'</span>, <span class="string">'cate_9_type1'</span>, <span class="string">'cate_10_type1'</span>, <span class="string">'cate_11_type1'</span>,</div><div class="line">        <span class="string">'cate_4_type2'</span>, <span class="string">'cate_5_type2'</span>, <span class="string">'cate_6_type2'</span>, <span class="string">'cate_7_type2'</span>,</div><div class="line">        <span class="string">'cate_8_type2'</span>, <span class="string">'cate_9_type2'</span>, <span class="string">'cate_10_type2'</span>, <span class="string">'cate_11_type2'</span>,</div><div class="line">        <span class="string">'cate_4_type3'</span>, <span class="string">'cate_5_type3'</span>, <span class="string">'cate_6_type3'</span>, <span class="string">'cate_7_type3'</span>,</div><div class="line">        <span class="string">'cate_8_type3'</span>, <span class="string">'cate_9_type3'</span>, <span class="string">'cate_10_type3'</span>, <span class="string">'cate_11_type3'</span>,</div><div class="line">        <span class="string">'cate_4_type4'</span>, <span class="string">'cate_5_type4'</span>, <span class="string">'cate_6_type4'</span>, <span class="string">'cate_7_type4'</span>,</div><div class="line">        <span class="string">'cate_8_type4'</span>, <span class="string">'cate_9_type4'</span>, <span class="string">'cate_10_type4'</span>, <span class="string">'cate_11_type4'</span>,</div><div class="line">        <span class="string">'cate_4_type5'</span>, <span class="string">'cate_5_type5'</span>, <span class="string">'cate_6_type5'</span>, <span class="string">'cate_7_type5'</span>,</div><div class="line">        <span class="string">'cate_8_type5'</span>, <span class="string">'cate_9_type5'</span>, <span class="string">'cate_10_type5'</span>, <span class="string">'cate_11_type5'</span>,</div><div class="line">        <span class="string">'cate_4_type6'</span>, <span class="string">'cate_5_type6'</span>, <span class="string">'cate_6_type6'</span>, <span class="string">'cate_7_type6'</span>,</div><div class="line">        <span class="string">'cate_8_type6'</span>, <span class="string">'cate_9_type6'</span>, <span class="string">'cate_10_type6'</span>, <span class="string">'cate_11_type6'</span></div><div class="line">    ]</div><div class="line">    actions = actions.fillna(<span class="number">0</span>)</div><div class="line">    actions[<span class="string">'cate_action_sum'</span>] = actions.sum(axis=<span class="number">1</span>)</div><div class="line">    actions[<span class="string">'cate8_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_8_type1'</span>] + actions[<span class="string">'cate_8_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_8_type3'</span>] + actions[<span class="string">'cate_8_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_8_type5'</span>] + actions[<span class="string">'cate_8_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line">    actions[<span class="string">'cate4_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_4_type1'</span>] + actions[<span class="string">'cate_4_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_4_type3'</span>] + actions[<span class="string">'cate_4_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_4_type5'</span>] + actions[<span class="string">'cate_4_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line">    actions[<span class="string">'cate5_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_5_type1'</span>] + actions[<span class="string">'cate_5_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_5_type3'</span>] + actions[<span class="string">'cate_5_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_5_type5'</span>] + actions[<span class="string">'cate_5_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line">    actions[<span class="string">'cate6_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_6_type1'</span>] + actions[<span class="string">'cate_6_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_6_type3'</span>] + actions[<span class="string">'cate_6_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_6_type5'</span>] + actions[<span class="string">'cate_6_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line">    actions[<span class="string">'cate7_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_7_type1'</span>] + actions[<span class="string">'cate_7_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_7_type3'</span>] + actions[<span class="string">'cate_7_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_7_type5'</span>] + actions[<span class="string">'cate_7_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line">    actions[<span class="string">'cate9_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_9_type1'</span>] + actions[<span class="string">'cate_9_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_9_type3'</span>] + actions[<span class="string">'cate_9_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_9_type5'</span>] + actions[<span class="string">'cate_9_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line">    actions[<span class="string">'cate10_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_10_type1'</span>] + actions[<span class="string">'cate_10_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_10_type3'</span>] + actions[<span class="string">'cate_10_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_10_type5'</span>] + actions[<span class="string">'cate_10_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line">    actions[<span class="string">'cate11_percentage'</span>] = (</div><div class="line">        actions[<span class="string">'cate_11_type1'</span>] + actions[<span class="string">'cate_11_type2'</span>] +</div><div class="line">        actions[<span class="string">'cate_11_type3'</span>] + actions[<span class="string">'cate_11_type4'</span>] +</div><div class="line">        actions[<span class="string">'cate_11_type5'</span>] + actions[<span class="string">'cate_11_type6'</span>]</div><div class="line">    ) / actions[<span class="string">'cate_action_sum'</span>]</div><div class="line"></div><div class="line">    actions[<span class="string">'cate8_type1_percentage'</span>] = np.log(</div><div class="line">        <span class="number">1</span> + actions[<span class="string">'cate_8_type1'</span>]) - np.log(</div><div class="line">            <span class="number">1</span> + actions[<span class="string">'cate_8_type1'</span>] + actions[<span class="string">'cate_4_type1'</span>] +</div><div class="line">            actions[<span class="string">'cate_5_type1'</span>] + actions[<span class="string">'cate_6_type1'</span>] +</div><div class="line">            actions[<span class="string">'cate_7_type1'</span>] + actions[<span class="string">'cate_9_type1'</span>] +</div><div class="line">            actions[<span class="string">'cate_10_type1'</span>] + actions[<span class="string">'cate_11_type1'</span>])</div><div class="line"></div><div class="line">    actions[<span class="string">'cate8_type2_percentage'</span>] = np.log(</div><div class="line">        <span class="number">1</span> + actions[<span class="string">'cate_8_type2'</span>]) - np.log(</div><div class="line">            <span class="number">1</span> + actions[<span class="string">'cate_8_type2'</span>] + actions[<span class="string">'cate_4_type2'</span>] +</div><div class="line">            actions[<span class="string">'cate_5_type2'</span>] + actions[<span class="string">'cate_6_type2'</span>] +</div><div class="line">            actions[<span class="string">'cate_7_type2'</span>] + actions[<span class="string">'cate_9_type2'</span>] +</div><div class="line">            actions[<span class="string">'cate_10_type2'</span>] + actions[<span class="string">'cate_11_type2'</span>])</div><div class="line">    actions[<span class="string">'cate8_type3_percentage'</span>] = np.log(</div><div class="line">        <span class="number">1</span> + actions[<span class="string">'cate_8_type3'</span>]) - np.log(</div><div class="line">            <span class="number">1</span> + actions[<span class="string">'cate_8_type3'</span>] + actions[<span class="string">'cate_4_type3'</span>] +</div><div class="line">            actions[<span class="string">'cate_5_type3'</span>] + actions[<span class="string">'cate_6_type3'</span>] +</div><div class="line">            actions[<span class="string">'cate_7_type3'</span>] + actions[<span class="string">'cate_9_type3'</span>] +</div><div class="line">            actions[<span class="string">'cate_10_type3'</span>] + actions[<span class="string">'cate_11_type3'</span>])</div><div class="line">    actions[<span class="string">'cate8_type4_percentage'</span>] = np.log(</div><div class="line">        <span class="number">1</span> + actions[<span class="string">'cate_8_type4'</span>]) - np.log(</div><div class="line">            <span class="number">1</span> + actions[<span class="string">'cate_8_type4'</span>] + actions[<span class="string">'cate_4_type4'</span>] +</div><div class="line">            actions[<span class="string">'cate_5_type4'</span>] + actions[<span class="string">'cate_6_type4'</span>] +</div><div class="line">            actions[<span class="string">'cate_7_type4'</span>] + actions[<span class="string">'cate_9_type4'</span>] +</div><div class="line">            actions[<span class="string">'cate_10_type4'</span>] + actions[<span class="string">'cate_11_type4'</span>])</div><div class="line">    actions[<span class="string">'cate8_type5_percentage'</span>] = np.log(</div><div class="line">        <span class="number">1</span> + actions[<span class="string">'cate_8_type5'</span>]) - np.log(</div><div class="line">            <span class="number">1</span> + actions[<span class="string">'cate_8_type5'</span>] + actions[<span class="string">'cate_4_type5'</span>] +</div><div class="line">            actions[<span class="string">'cate_5_type5'</span>] + actions[<span class="string">'cate_6_type5'</span>] +</div><div class="line">            actions[<span class="string">'cate_7_type5'</span>] + actions[<span class="string">'cate_9_type5'</span>] +</div><div class="line">            actions[<span class="string">'cate_10_type5'</span>] + actions[<span class="string">'cate_11_type5'</span>])</div><div class="line">    actions[<span class="string">'cate8_type6_percentage'</span>] = np.log(</div><div class="line">        <span class="number">1</span> + actions[<span class="string">'cate_8_type6'</span>]) - np.log(</div><div class="line">            <span class="number">1</span> + actions[<span class="string">'cate_8_type6'</span>] + actions[<span class="string">'cate_4_type6'</span>] +</div><div class="line">            actions[<span class="string">'cate_5_type6'</span>] + actions[<span class="string">'cate_6_type6'</span>] +</div><div class="line">            actions[<span class="string">'cate_7_type6'</span>] + actions[<span class="string">'cate_9_type6'</span>] +</div><div class="line">            actions[<span class="string">'cate_10_type6'</span>] + actions[<span class="string">'cate_11_type6'</span>])</div><div class="line">    actions[<span class="string">'user_id'</span>] = actions.index</div><div class="line">    actions = actions[[</div><div class="line">        <span class="string">'user_id'</span>, <span class="string">'cate8_percentage'</span>, <span class="string">'cate4_percentage'</span>, <span class="string">'cate5_percentage'</span>,</div><div class="line">        <span class="string">'cate6_percentage'</span>, <span class="string">'cate7_percentage'</span>, <span class="string">'cate9_percentage'</span>,</div><div class="line">        <span class="string">'cate10_percentage'</span>, <span class="string">'cate11_percentage'</span>, <span class="string">'cate8_type1_percentage'</span>,</div><div class="line">        <span class="string">'cate8_type2_percentage'</span>, <span class="string">'cate8_type3_percentage'</span>,</div><div class="line">        <span class="string">'cate8_type4_percentage'</span>, <span class="string">'cate8_type5_percentage'</span>,</div><div class="line">        <span class="string">'cate8_type6_percentage'</span></div><div class="line">    ]]</div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<h3 id="商品-行为"><a href="#商品-行为" class="headerlink" title="商品-行为"></a>商品-行为</h3><h4 id="累积商品特征"><a href="#累积商品特征" class="headerlink" title="累积商品特征"></a>累积商品特征</h4><ul>
<li>分时间段</li>
<li>针对商品的不同行为的<ul>
<li>购买转化率</li>
<li>均值</li>
<li>标准差</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_accumulate_product_feat</span><span class="params">(start_date, end_date, all_actions)</span>:</span></div><div class="line">    feature = [</div><div class="line">        <span class="string">'sku_id'</span>, <span class="string">'product_action_1'</span>, <span class="string">'product_action_2'</span>,</div><div class="line">        <span class="string">'product_action_3'</span>, <span class="string">'product_action_4'</span>,</div><div class="line">        <span class="string">'product_action_5'</span>, <span class="string">'product_action_6'</span>,</div><div class="line">        <span class="string">'product_action_1_ratio'</span>, <span class="string">'product_action_2_ratio'</span>,</div><div class="line">        <span class="string">'product_action_3_ratio'</span>, <span class="string">'product_action_5_ratio'</span>,</div><div class="line">        <span class="string">'product_action_6_ratio'</span>, <span class="string">'product_action_1_mean'</span>,</div><div class="line">        <span class="string">'product_action_2_mean'</span>, <span class="string">'product_action_3_mean'</span>,</div><div class="line">        <span class="string">'product_action_4_mean'</span>, <span class="string">'product_action_5_mean'</span>,</div><div class="line">        <span class="string">'product_action_6_mean'</span>, <span class="string">'product_action_1_std'</span>,</div><div class="line">        <span class="string">'product_action_2_std'</span>, <span class="string">'product_action_3_std'</span>, <span class="string">'product_action_4_std'</span>,</div><div class="line">        <span class="string">'product_action_5_std'</span>, <span class="string">'product_action_6_std'</span></div><div class="line">    ]</div><div class="line"></div><div class="line">    actions = get_actions(start_date, end_date, all_actions)</div><div class="line">    df = pd.get_dummies(actions[<span class="string">'type'</span>], prefix=<span class="string">'product_action'</span>)</div><div class="line">    <span class="comment"># 按照商品-日期分组，计算某个时间段该商品的各项行为的标准差</span></div><div class="line"><span class="comment">#     actions['date'] = pd.to_datetime(actions['time']).apply(lambda x: x.date())</span></div><div class="line">    actions = pd.concat([actions[[<span class="string">'sku_id'</span>, <span class="string">'date'</span>]], df], axis=<span class="number">1</span>)</div><div class="line">    actions_date = actions.groupby([<span class="string">'sku_id'</span>, <span class="string">'date'</span>]).sum()</div><div class="line">    actions_date = actions_date.unstack()</div><div class="line">    actions_date.fillna(<span class="number">0</span>, inplace=<span class="keyword">True</span>)</div><div class="line">    action_1 = np.std(actions_date[<span class="string">'product_action_1'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_1 = action_1.to_frame()</div><div class="line">    action_1.columns = [<span class="string">'product_action_1_std'</span>]</div><div class="line">    action_2 = np.std(actions_date[<span class="string">'product_action_2'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_2 = action_2.to_frame()</div><div class="line">    action_2.columns = [<span class="string">'product_action_2_std'</span>]</div><div class="line">    action_3 = np.std(actions_date[<span class="string">'product_action_3'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_3 = action_3.to_frame()</div><div class="line">    action_3.columns = [<span class="string">'product_action_3_std'</span>]</div><div class="line">    action_4 = np.std(actions_date[<span class="string">'product_action_4'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_4 = action_4.to_frame()</div><div class="line">    action_4.columns = [<span class="string">'product_action_4_std'</span>]</div><div class="line">    action_5 = np.std(actions_date[<span class="string">'product_action_5'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_5 = action_5.to_frame()</div><div class="line">    action_5.columns = [<span class="string">'product_action_5_std'</span>]</div><div class="line">    action_6 = np.std(actions_date[<span class="string">'product_action_6'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_6 = action_6.to_frame()</div><div class="line">    action_6.columns = [<span class="string">'product_action_6_std'</span>]</div><div class="line">    actions_date = pd.concat(</div><div class="line">        [action_1, action_2, action_3, action_4, action_5, action_6], axis=<span class="number">1</span>)</div><div class="line">    actions_date[<span class="string">'sku_id'</span>] = actions_date.index</div><div class="line"></div><div class="line">    actions = actions.groupby([<span class="string">'sku_id'</span>], as_index=<span class="keyword">False</span>).sum()</div><div class="line">    days_interal = (datetime.strptime(end_date, <span class="string">'%Y-%m-%d'</span>) - datetime.strptime(start_date, <span class="string">'%Y-%m-%d'</span>)).days</div><div class="line">    <span class="comment"># 针对商品分组，计算购买转化率</span></div><div class="line"><span class="comment">#     actions['product_action_1_ratio'] = actions['product_action_4'] / actions[</span></div><div class="line"><span class="comment">#         'product_action_1']</span></div><div class="line"><span class="comment">#     actions['product_action_2_ratio'] = actions['product_action_4'] / actions[</span></div><div class="line"><span class="comment">#         'product_action_2']</span></div><div class="line"><span class="comment">#     actions['product_action_3_ratio'] = actions['product_action_4'] / actions[</span></div><div class="line"><span class="comment">#         'product_action_3']</span></div><div class="line"><span class="comment">#     actions['product_action_5_ratio'] = actions['product_action_4'] / actions[</span></div><div class="line"><span class="comment">#         'product_action_5']</span></div><div class="line"><span class="comment">#     actions['product_action_6_ratio'] = actions['product_action_4'] / actions[</span></div><div class="line"><span class="comment">#         'product_action_6']</span></div><div class="line">    actions[<span class="string">'product_action_1_ratio'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'product_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'product_action_1'</span>])</div><div class="line">    actions[<span class="string">'product_action_2_ratio'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'product_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'product_action_2'</span>])</div><div class="line">    actions[<span class="string">'product_action_3_ratio'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'product_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'product_action_3'</span>])</div><div class="line">    actions[<span class="string">'product_action_5_ratio'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'product_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'product_action_5'</span>])</div><div class="line">    actions[<span class="string">'product_action_6_ratio'</span>] =  np.log(<span class="number">1</span> + actions[<span class="string">'product_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'product_action_6'</span>])</div><div class="line">    <span class="comment"># 计算各种行为的均值</span></div><div class="line">    actions[<span class="string">'product_action_1_mean'</span>] = actions[</div><div class="line">        <span class="string">'product_action_1'</span>] / days_interal</div><div class="line">    actions[<span class="string">'product_action_2_mean'</span>] = actions[</div><div class="line">        <span class="string">'product_action_2'</span>] / days_interal</div><div class="line">    actions[<span class="string">'product_action_3_mean'</span>] = actions[</div><div class="line">        <span class="string">'product_action_3'</span>] / days_interal</div><div class="line">    actions[<span class="string">'product_action_4_mean'</span>] = actions[</div><div class="line">        <span class="string">'product_action_4'</span>] / days_interal</div><div class="line">    actions[<span class="string">'product_action_5_mean'</span>] = actions[</div><div class="line">        <span class="string">'product_action_5'</span>] / days_interal</div><div class="line">    actions[<span class="string">'product_action_6_mean'</span>] = actions[</div><div class="line">        <span class="string">'product_action_6'</span>] / days_interal</div><div class="line">    actions = pd.merge(actions, actions_date, how=<span class="string">'left'</span>, on=<span class="string">'sku_id'</span>)</div><div class="line">    actions = actions[feature]</div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<h3 id="类别特征"><a href="#类别特征" class="headerlink" title="类别特征"></a>类别特征</h3><p>分时间段下各个商品类别的</p>
<ul>
<li>购买转化率</li>
<li>标准差</li>
<li>均值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_accumulate_cate_feat</span><span class="params">(start_date, end_date, all_actions)</span>:</span></div><div class="line">    feature = [<span class="string">'cate'</span>,<span class="string">'cate_action_1'</span>, <span class="string">'cate_action_2'</span>, <span class="string">'cate_action_3'</span>, <span class="string">'cate_action_4'</span>, <span class="string">'cate_action_5'</span>, </div><div class="line">               <span class="string">'cate_action_6'</span>, <span class="string">'cate_action_1_ratio'</span>, <span class="string">'cate_action_2_ratio'</span>, </div><div class="line">               <span class="string">'cate_action_3_ratio'</span>, <span class="string">'cate_action_5_ratio'</span>, <span class="string">'cate_action_6_ratio'</span>, <span class="string">'cate_action_1_mean'</span>,</div><div class="line">               <span class="string">'cate_action_2_mean'</span>, <span class="string">'cate_action_3_mean'</span>, <span class="string">'cate_action_4_mean'</span>, <span class="string">'cate_action_5_mean'</span>,</div><div class="line">               <span class="string">'cate_action_6_mean'</span>, <span class="string">'cate_action_1_std'</span>, <span class="string">'cate_action_2_std'</span>, <span class="string">'cate_action_3_std'</span>,</div><div class="line">               <span class="string">'cate_action_4_std'</span>, <span class="string">'cate_action_5_std'</span>, <span class="string">'cate_action_6_std'</span>]</div><div class="line">    actions = get_actions(start_date, end_date, all_actions)</div><div class="line"><span class="comment">#     actions['date'] = pd.to_datetime(actions['time']).apply(lambda x: x.date())</span></div><div class="line">    df = pd.get_dummies(actions[<span class="string">'type'</span>], prefix=<span class="string">'cate_action'</span>)</div><div class="line">    actions = pd.concat([actions[[<span class="string">'cate'</span>,<span class="string">'date'</span>]], df], axis=<span class="number">1</span>)</div><div class="line">    <span class="comment"># 按照类别-日期分组计算针对不同类别的各种行为某段时间的标准差</span></div><div class="line">    actions_date = actions.groupby([<span class="string">'cate'</span>,<span class="string">'date'</span>]).sum()</div><div class="line">    actions_date = actions_date.unstack()</div><div class="line">    actions_date.fillna(<span class="number">0</span>, inplace=<span class="keyword">True</span>)</div><div class="line">    action_1 = np.std(actions_date[<span class="string">'cate_action_1'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_1 = action_1.to_frame()</div><div class="line">    action_1.columns = [<span class="string">'cate_action_1_std'</span>]</div><div class="line">    action_2 = np.std(actions_date[<span class="string">'cate_action_2'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_2 = action_2.to_frame()</div><div class="line">    action_2.columns = [<span class="string">'cate_action_2_std'</span>]</div><div class="line">    action_3 = np.std(actions_date[<span class="string">'cate_action_3'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_3 = action_3.to_frame()</div><div class="line">    action_3.columns = [<span class="string">'cate_action_3_std'</span>]</div><div class="line">    action_4 = np.std(actions_date[<span class="string">'cate_action_4'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_4 = action_4.to_frame()</div><div class="line">    action_4.columns = [<span class="string">'cate_action_4_std'</span>]</div><div class="line">    action_5 = np.std(actions_date[<span class="string">'cate_action_5'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_5 = action_5.to_frame()</div><div class="line">    action_5.columns = [<span class="string">'cate_action_5_std'</span>]</div><div class="line">    action_6 = np.std(actions_date[<span class="string">'cate_action_6'</span>], axis=<span class="number">1</span>)</div><div class="line">    action_6 = action_6.to_frame()</div><div class="line">    action_6.columns = [<span class="string">'cate_action_6_std'</span>]</div><div class="line">    actions_date = pd.concat([action_1, action_2, action_3, action_4, action_5, action_6], axis=<span class="number">1</span>)</div><div class="line">    actions_date[<span class="string">'cate'</span>] = actions_date.index</div><div class="line">    <span class="comment"># 按照类别分组，统计各个商品类别下行为的转化率</span></div><div class="line">    actions = actions.groupby([<span class="string">'cate'</span>], as_index=<span class="keyword">False</span>).sum()</div><div class="line">    days_interal = (datetime.strptime(end_date, <span class="string">'%Y-%m-%d'</span>)-datetime.strptime(start_date, <span class="string">'%Y-%m-%d'</span>)).days</div><div class="line">    </div><div class="line"><span class="comment">#     actions['cate_action_1_ratio'] = actions['cate_action_4'] / actions['cate_action_1']</span></div><div class="line"><span class="comment">#     actions['cate_action_2_ratio'] = actions['cate_action_4'] / actions['cate_action_2']</span></div><div class="line"><span class="comment">#     actions['cate_action_3_ratio'] = actions['cate_action_4'] / actions['cate_action_3']</span></div><div class="line"><span class="comment">#     actions['cate_action_5_ratio'] = actions['cate_action_4'] / actions['cate_action_5']</span></div><div class="line"><span class="comment">#     actions['cate_action_6_ratio'] = actions['cate_action_4'] / actions['cate_action_6']</span></div><div class="line">    actions[<span class="string">'cate_action_1_ratio'</span>] =(np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_1'</span>]))</div><div class="line">    actions[<span class="string">'cate_action_2_ratio'</span>] =(np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_2'</span>]))</div><div class="line">    actions[<span class="string">'cate_action_3_ratio'</span>] =(np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_3'</span>]))</div><div class="line">    actions[<span class="string">'cate_action_5_ratio'</span>] =(np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_5'</span>]))</div><div class="line">    actions[<span class="string">'cate_action_6_ratio'</span>] =(np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_4'</span>]) - np.log(<span class="number">1</span> + actions[<span class="string">'cate_action_6'</span>]))</div><div class="line">    <span class="comment"># 按照类别分组，统计各个商品类别下行为在一段时间的均值</span></div><div class="line">    actions[<span class="string">'cate_action_1_mean'</span>] = actions[<span class="string">'cate_action_1'</span>] /  days_interal</div><div class="line">    actions[<span class="string">'cate_action_2_mean'</span>] = actions[<span class="string">'cate_action_2'</span>] /  days_interal</div><div class="line">    actions[<span class="string">'cate_action_3_mean'</span>] = actions[<span class="string">'cate_action_3'</span>] /  days_interal</div><div class="line">    actions[<span class="string">'cate_action_4_mean'</span>] = actions[<span class="string">'cate_action_4'</span>] /  days_interal</div><div class="line">    actions[<span class="string">'cate_action_5_mean'</span>] = actions[<span class="string">'cate_action_5'</span>] /  days_interal</div><div class="line">    actions[<span class="string">'cate_action_6_mean'</span>] = actions[<span class="string">'cate_action_6'</span>] /  days_interal</div><div class="line">    actions = pd.merge(actions, actions_date, how =<span class="string">'left'</span>,on=<span class="string">'cate'</span>)</div><div class="line">    actions = actions[feature]</div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<h3 id="构造训练集-验证集"><a href="#构造训练集-验证集" class="headerlink" title="构造训练集/验证集"></a>构造训练集/验证集</h3><ul>
<li>标签,采用滑动窗口的方式，构造训练集的时候针对产生购买的行为标记为1</li>
<li>整合特征</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_labels</span><span class="params">(start_date, end_date, all_actions)</span>:</span></div><div class="line">    actions = get_actions(start_date, end_date, all_actions)</div><div class="line"><span class="comment">#     actions = actions[actions['type'] == 4]</span></div><div class="line">    <span class="comment"># 修改为预测购买了商品8的用户预测</span></div><div class="line">    actions = actions[(actions[<span class="string">'type'</span>] == <span class="number">4</span>) &amp; (actions[<span class="string">'cate'</span>]==<span class="number">8</span>)]</div><div class="line">    </div><div class="line">    actions = actions.groupby([<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>], as_index=<span class="keyword">False</span>).sum()</div><div class="line">    actions[<span class="string">'label'</span>] = <span class="number">1</span></div><div class="line">    actions = actions[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'label'</span>]]</div><div class="line">    <span class="keyword">return</span> actions</div></pre></td></tr></table></figure>
<p>构造训练集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_actions</span><span class="params">(user, product, all_actions, train_start_date)</span>:</span></div><div class="line">    train_end_date = datetime.strptime(train_start_date, <span class="string">'%Y-%m-%d'</span>) + timedelta(days=<span class="number">3</span>)</div><div class="line">    train_end_date = train_end_date.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">    <span class="comment"># 修正prod_acc,cate_acc的时间跨度</span></div><div class="line">    start_days = datetime.strptime(train_end_date, <span class="string">'%Y-%m-%d'</span>) - timedelta(days=<span class="number">30</span>)</div><div class="line">    start_days = start_days.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">    <span class="keyword">print</span> train_end_date</div><div class="line">    user_acc = get_recent_user_feat(train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_recent_user_feat finsihed'</span></div><div class="line">    </div><div class="line">    user_cate = get_user_cate_feature(train_start_date, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_user_cate_feature finished'</span></div><div class="line">    </div><div class="line">    product_acc = get_accumulate_product_feat(start_days, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_accumulate_product_feat finsihed'</span></div><div class="line">    cate_acc = get_accumulate_cate_feat(start_days, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_accumulate_cate_feat finsihed'</span></div><div class="line">    comment_acc = get_comments_product_feat(train_end_date)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_comments_product_feat finished'</span></div><div class="line">    <span class="comment"># 标记</span></div><div class="line">    test_start_date = train_end_date</div><div class="line">    test_end_date = datetime.strptime(test_start_date, <span class="string">'%Y-%m-%d'</span>) + timedelta(days=<span class="number">5</span>)</div><div class="line">    test_end_date = test_end_date.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">    labels = get_labels(test_start_date, test_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">"get labels"</span></div><div class="line">    </div><div class="line">    actions = <span class="keyword">None</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">30</span>):</div><div class="line">        start_days = datetime.strptime(train_end_date, <span class="string">'%Y-%m-%d'</span>) - timedelta(days=i)</div><div class="line">        start_days = start_days.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">        <span class="keyword">if</span> actions <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            actions = get_action_feat(start_days, train_end_date, all_actions, i)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="comment"># 注意这里的拼接key</span></div><div class="line">            actions = pd.merge(actions, get_action_feat(start_days, train_end_date, all_actions, i), how=<span class="string">'left'</span>,</div><div class="line">                               on=[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'cate'</span>])</div><div class="line"></div><div class="line">    actions = pd.merge(actions, user, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    actions = pd.merge(actions, user_acc, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    actions = pd.merge(actions, user_cate, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    <span class="comment"># 注意这里的拼接key</span></div><div class="line">    actions = pd.merge(actions, product, how=<span class="string">'left'</span>, on=[<span class="string">'sku_id'</span>, <span class="string">'cate'</span>])</div><div class="line">    actions = pd.merge(actions, product_acc, how=<span class="string">'left'</span>, on=<span class="string">'sku_id'</span>)</div><div class="line">    actions = pd.merge(actions, cate_acc, how=<span class="string">'left'</span>, on=<span class="string">'cate'</span>)</div><div class="line">    actions = pd.merge(actions, comment_acc, how=<span class="string">'left'</span>, on=<span class="string">'sku_id'</span>)</div><div class="line">    actions = pd.merge(actions, labels, how=<span class="string">'left'</span>, on=[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>])</div><div class="line">    <span class="comment"># 主要是填充拼接商品基本特征、评论特征、标签之后的空值</span></div><div class="line">    actions = actions.fillna(<span class="number">0</span>)</div><div class="line"><span class="comment">#     return actions</span></div><div class="line">    <span class="comment"># 采样</span></div><div class="line">    action_postive = actions[actions[<span class="string">'label'</span>] == <span class="number">1</span>]</div><div class="line">    action_negative = actions[actions[<span class="string">'label'</span>] == <span class="number">0</span>]</div><div class="line">    <span class="keyword">del</span> actions</div><div class="line">    neg_len = len(action_postive) * <span class="number">10</span></div><div class="line">    action_negative = action_negative.sample(n=neg_len)</div><div class="line">    action_sample = pd.concat([action_postive, action_negative], ignore_index=<span class="keyword">True</span>)    </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> action_sample</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_train_set</span><span class="params">(train_start_date, setNums ,f_path)</span>:</span></div><div class="line">    train_actions = <span class="keyword">None</span></div><div class="line">    all_actions = get_all_action()</div><div class="line">    <span class="keyword">print</span> <span class="string">"get all actions!"</span></div><div class="line">    user = get_basic_user_feat()</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_basic_user_feat finsihed'</span></div><div class="line">    product = get_basic_product_feat()</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_basic_product_feat finsihed'</span></div><div class="line">    <span class="comment"># 滑窗,构造多组训练集/验证集</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(setNums):</div><div class="line">        <span class="keyword">print</span> train_start_date</div><div class="line">        <span class="keyword">if</span> train_actions <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            train_actions = make_actions(user, product, all_actions, train_start_date)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            train_actions = pd.concat([train_actions, make_actions(user, product, all_actions, train_start_date)],</div><div class="line">                                          ignore_index=<span class="keyword">True</span>)</div><div class="line">        <span class="comment"># 接下来每次移动一天</span></div><div class="line">        train_start_date = datetime.strptime(train_start_date, <span class="string">'%Y-%m-%d'</span>) + timedelta(days=<span class="number">1</span>)</div><div class="line">        train_start_date = train_start_date.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">        <span class="keyword">print</span> <span class="string">"round &#123;0&#125;/&#123;1&#125; over!"</span>.format(i+<span class="number">1</span>, setNums)</div><div class="line"></div><div class="line">    train_actions.to_csv(f_path, index=<span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 训练集</span></div><div class="line">train_start_date = <span class="string">'2016-03-01'</span></div><div class="line">make_train_set(train_start_date, <span class="number">34</span>, <span class="string">'train_set.csv'</span>)</div></pre></td></tr></table></figure>
<p>构造线下测试集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_val_answer</span><span class="params">(val_start_date, val_end_date, all_actions, label_val_s1_path)</span>:</span></div><div class="line">    actions = get_actions(val_start_date, val_end_date,all_actions)</div><div class="line">    actions = actions[(actions[<span class="string">'type'</span>] == <span class="number">4</span>) &amp; (actions[<span class="string">'cate'</span>] == <span class="number">8</span>)]</div><div class="line">    actions = actions[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>]]</div><div class="line">    actions = actions.drop_duplicates()</div><div class="line">    actions.to_csv(label_val_s1_path, index=<span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_val_set</span><span class="params">(train_start_date, train_end_date, val_s1_path)</span>:</span></div><div class="line">    <span class="comment"># 修改时间跨度</span></div><div class="line">    start_days = datetime.strptime(train_end_date, <span class="string">'%Y-%m-%d'</span>) - timedelta(days=<span class="number">30</span>)</div><div class="line">    start_days = start_days.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">    all_actions = get_all_action()</div><div class="line">    <span class="keyword">print</span> <span class="string">"get all actions!"</span></div><div class="line">    user = get_basic_user_feat()</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_basic_user_feat finsihed'</span></div><div class="line">    </div><div class="line">    product = get_basic_product_feat()</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_basic_product_feat finsihed'</span></div><div class="line"><span class="comment">#     user_acc = get_accumulate_user_feat(train_end_date,all_actions,30)</span></div><div class="line"><span class="comment">#     print 'get_accumulate_user_feat finished'</span></div><div class="line">    user_acc = get_recent_user_feat(train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_recent_user_feat finsihed'</span></div><div class="line">    user_cate = get_user_cate_feature(train_start_date, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_user_cate_feature finished'</span></div><div class="line"> </div><div class="line">    product_acc = get_accumulate_product_feat(start_days, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_accumulate_product_feat finsihed'</span></div><div class="line">    cate_acc = get_accumulate_cate_feat(start_days, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_accumulate_cate_feat finsihed'</span></div><div class="line">    comment_acc = get_comments_product_feat(train_end_date)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_comments_product_feat finished'</span></div><div class="line">    </div><div class="line">    actions = <span class="keyword">None</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">30</span>):</div><div class="line">        start_days = datetime.strptime(train_end_date, <span class="string">'%Y-%m-%d'</span>) - timedelta(days=i)</div><div class="line">        start_days = start_days.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">        <span class="keyword">if</span> actions <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            actions = get_action_feat(start_days, train_end_date, all_actions,i)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            actions = pd.merge(actions, get_action_feat(start_days, train_end_date,all_actions,i), how=<span class="string">'left'</span>,</div><div class="line">                               on=[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'cate'</span>])</div><div class="line"></div><div class="line">    actions = pd.merge(actions, user, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    actions = pd.merge(actions, user_acc, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    actions = pd.merge(actions, user_cate, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    <span class="comment"># 注意这里的拼接key</span></div><div class="line">    actions = pd.merge(actions, product, how=<span class="string">'left'</span>, on=[<span class="string">'sku_id'</span>, <span class="string">'cate'</span>])</div><div class="line">    actions = pd.merge(actions, product_acc, how=<span class="string">'left'</span>, on=<span class="string">'sku_id'</span>)</div><div class="line">    actions = pd.merge(actions, cate_acc, how=<span class="string">'left'</span>, on=<span class="string">'cate'</span>)</div><div class="line">    actions = pd.merge(actions, comment_acc, how=<span class="string">'left'</span>, on=<span class="string">'sku_id'</span>)</div><div class="line">    actions = actions.fillna(<span class="number">0</span>)</div><div class="line">   </div><div class="line">    </div><div class="line"><span class="comment">#     print actions</span></div><div class="line">    <span class="comment"># 构造真实用户购买情况作为后续验证</span></div><div class="line">    val_start_date = train_end_date</div><div class="line">    val_end_date = datetime.strptime(val_start_date, <span class="string">'%Y-%m-%d'</span>) + timedelta(days=<span class="number">5</span>)</div><div class="line">    val_end_date = val_end_date.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">    make_val_answer(val_start_date, val_end_date, all_actions, <span class="string">'label_'</span>+val_s1_path)</div><div class="line">    </div><div class="line">    actions.to_csv(val_s1_path, index=<span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 验证集</span></div><div class="line"><span class="comment"># train_start_date = '2016-04-06'</span></div><div class="line"><span class="comment"># make_train_set(train_start_date, 3, 'val_set.csv')</span></div><div class="line">make_val_set(<span class="string">'2016-04-06'</span>, <span class="string">'2016-04-09'</span>, <span class="string">'val_1.csv'</span>)</div><div class="line">make_val_set(<span class="string">'2016-04-07'</span>, <span class="string">'2016-04-10'</span>, <span class="string">'val_2.csv'</span>)</div><div class="line">make_val_set(<span class="string">'2016-04-08'</span>, <span class="string">'2016-04-11'</span>, <span class="string">'val_3.csv'</span>)</div></pre></td></tr></table></figure>
<h3 id="构造测试集"><a href="#构造测试集" class="headerlink" title="构造测试集"></a>构造测试集</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_test_set</span><span class="params">(train_start_date, train_end_date)</span>:</span></div><div class="line">    start_days = datetime.strptime(train_end_date, <span class="string">'%Y-%m-%d'</span>) - timedelta(days=<span class="number">30</span>)</div><div class="line">    start_days = start_days.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">    all_actions = get_all_action()</div><div class="line">    <span class="keyword">print</span> <span class="string">"get all actions!"</span></div><div class="line">    user = get_basic_user_feat()</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_basic_user_feat finsihed'</span></div><div class="line">    product = get_basic_product_feat()</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_basic_product_feat finsihed'</span></div><div class="line">    </div><div class="line">    user_acc = get_recent_user_feat(train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_accumulate_user_feat finsihed'</span></div><div class="line">    </div><div class="line">    user_cate = get_user_cate_feature(train_start_date, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_user_cate_feature finished'</span></div><div class="line">    </div><div class="line">    product_acc = get_accumulate_product_feat(start_days, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_accumulate_product_feat finsihed'</span></div><div class="line">    cate_acc = get_accumulate_cate_feat(start_days, train_end_date, all_actions)</div><div class="line">    <span class="keyword">print</span> <span class="string">'get_accumulate_cate_feat finsihed'</span></div><div class="line">    comment_acc = get_comments_product_feat(train_end_date)</div><div class="line"></div><div class="line">    actions = <span class="keyword">None</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">30</span>):</div><div class="line">        start_days = datetime.strptime(train_end_date, <span class="string">'%Y-%m-%d'</span>) - timedelta(days=i)</div><div class="line">        start_days = start_days.strftime(<span class="string">'%Y-%m-%d'</span>)</div><div class="line">        <span class="keyword">if</span> actions <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            actions = get_action_feat(start_days, train_end_date, all_actions,i)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            actions = pd.merge(actions, get_action_feat(start_days, train_end_date,all_actions,i), how=<span class="string">'left'</span>,</div><div class="line">                               on=[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'cate'</span>])</div><div class="line"></div><div class="line">    actions = pd.merge(actions, user, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    actions = pd.merge(actions, user_acc, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    actions = pd.merge(actions, user_cate, how=<span class="string">'left'</span>, on=<span class="string">'user_id'</span>)</div><div class="line">    <span class="comment"># 注意这里的拼接key</span></div><div class="line">    actions = pd.merge(actions, product, how=<span class="string">'left'</span>, on=[<span class="string">'sku_id'</span>, <span class="string">'cate'</span>])</div><div class="line">    actions = pd.merge(actions, product_acc, how=<span class="string">'left'</span>, on=<span class="string">'sku_id'</span>)</div><div class="line">    actions = pd.merge(actions, cate_acc, how=<span class="string">'left'</span>, on=<span class="string">'cate'</span>)</div><div class="line">    actions = pd.merge(actions, comment_acc, how=<span class="string">'left'</span>, on=<span class="string">'sku_id'</span>)</div><div class="line"></div><div class="line">    actions = actions.fillna(<span class="number">0</span>)</div><div class="line">    </div><div class="line"></div><div class="line">    actions.to_csv(<span class="string">"test_set.csv"</span>, index=<span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<p>4.13~4.16这三天的评论记录似乎并不存在为0的情况，导致构建测试集时出错</p>
<p><code>KeyError: &quot;[&#39;comment_num_0&#39;] not in index&quot;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 预测结果</span></div><div class="line">sub_start_date = <span class="string">'2016-04-13'</span></div><div class="line">sub_end_date = <span class="string">'2016-04-16'</span></div><div class="line">make_test_set(sub_start_date, sub_end_date)</div></pre></td></tr></table></figure>
<h2 id="模型设计和评估"><a href="#模型设计和评估" class="headerlink" title="模型设计和评估"></a>模型设计和评估</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</div><div class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pylab <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># import gc</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_record</span><span class="params">()</span>:</span></div><div class="line">    train = pd.read_csv(<span class="string">'train_set.csv'</span>)</div><div class="line"><span class="comment">#     valid = pd.read_csv('val_set.csv')</span></div><div class="line"><span class="comment">#     label_val = pd.read_csv('label_val_set.csv')</span></div><div class="line">    valid1 = pd.read_csv(<span class="string">'val_1.csv'</span>)</div><div class="line">    valid2 = pd.read_csv(<span class="string">'val_2.csv'</span>)</div><div class="line">    valid3 = pd.read_csv(<span class="string">'val_3.csv'</span>)</div><div class="line"><span class="comment">#     test = pd.read_csv('test_set.csv')</span></div><div class="line">    <span class="keyword">print</span> train.shape</div><div class="line"><span class="comment">#     print valid.shape</span></div><div class="line"><span class="comment">#     print label_val.shape</span></div><div class="line"><span class="comment">#     print test.shape</span></div><div class="line">    <span class="keyword">print</span> valid1.shape</div><div class="line">    <span class="keyword">print</span> valid2.shape</div><div class="line">    <span class="keyword">print</span> valid3.shape</div><div class="line"></div><div class="line"><span class="comment"># show_record()</span></div><div class="line"><span class="comment"># del train, valid, test</span></div><div class="line"><span class="comment"># gc.collect()</span></div></pre></td></tr></table></figure>
<h3 id="训练模型"><a href="#训练模型" class="headerlink" title="训练模型"></a>训练模型</h3><ul>
<li>返回训练后的模型</li>
<li>生成特征map文件作为后续特征重要性之用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_feature_map</span><span class="params">(features)</span>:</span></div><div class="line">    outfile = open(<span class="string">r'xgb.fmap'</span>, <span class="string">'w'</span>)</div><div class="line">    i = <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> feat <span class="keyword">in</span> features:</div><div class="line">        outfile.write(<span class="string">'&#123;0&#125;\t&#123;1&#125;\tq\n'</span>.format(i, feat))</div><div class="line">        i = i + <span class="number">1</span></div><div class="line">    outfile.close()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">xgb_model</span><span class="params">(train_set)</span>:</span></div><div class="line">    actions = pd.read_csv(train_set)             <span class="comment">#read train_set</span></div><div class="line">    <span class="comment"># 单纯的删掉模型前一遍训练认为无用的特征（根据特征重要性中不存在的特征）</span></div><div class="line">    lst_useless = [<span class="string">'brand'</span>]</div><div class="line">    </div><div class="line">    actions.drop(lst_useless, inplace=<span class="keyword">True</span>, axis=<span class="number">1</span>)</div><div class="line">    </div><div class="line">    users = actions[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>]].copy()</div><div class="line">    labels = actions[<span class="string">'label'</span>].copy()</div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'user_id'</span>]</div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'sku_id'</span>]</div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'label'</span>]</div><div class="line">    <span class="comment"># 尝试通过设置scale_pos_weight来调整政府比例不均的问题，但是经过采样的正负比为1:10，训练结果反而不如设置为1</span></div><div class="line"><span class="comment">#     ratio = float(np.sum(labels==0)) / np.sum(labels==1)</span></div><div class="line"><span class="comment">#     print ratio</span></div><div class="line">    </div><div class="line">    <span class="comment"># write to feature map</span></div><div class="line">    features = list(actions.columns[:])</div><div class="line">    <span class="keyword">print</span> <span class="string">'total features: '</span>, len(features)</div><div class="line">    create_feature_map(features)</div><div class="line">    <span class="comment"># 训练时即传入特征名</span></div><div class="line"><span class="comment">#     features = list(actions.columns.values)</span></div><div class="line">    </div><div class="line">    user_index=users</div><div class="line">    training_data=actions</div><div class="line">    label=labels</div><div class="line">    X_train, X_valid, y_train, y_valid = train_test_split(training_data.values, label.values, test_size=<span class="number">0.2</span>, </div><div class="line">                                                          random_state=<span class="number">0</span>)</div><div class="line">    </div><div class="line">    <span class="comment"># 尝试通过提前设置传入训练的正负例的权重来改善正负比例不均的问题</span></div><div class="line"><span class="comment">#     weights = np.zeros(len(y_train))</span></div><div class="line"><span class="comment">#     weights[y_train==0] = 1</span></div><div class="line"><span class="comment">#     weights[y_train==1] = 10</span></div><div class="line">    </div><div class="line"><span class="comment">#     dtrain = xgb.DMatrix(X_train, label=y_train, weight=weights)</span></div><div class="line">    dtrain = xgb.DMatrix(X_train, label=y_train)</div><div class="line">    dvalid = xgb.DMatrix(X_valid, label=y_valid)</div><div class="line"><span class="comment">#     dtrain = xgb.DMatrix(X_train, label=y_train, feature_names=features)</span></div><div class="line"><span class="comment">#     dvalid = xgb.DMatrix(X_valid, label=y_valid, feature_names=features)</span></div><div class="line"><span class="comment">#     dtrain = xgb.DMatrix(training_data.values, label.values)</span></div><div class="line">    param = &#123;<span class="string">'n_estimators'</span>: <span class="number">4000</span>, <span class="string">'max_depth'</span>: <span class="number">3</span>, <span class="string">'min_child_weight'</span>: <span class="number">5</span>, <span class="string">'gamma'</span>: <span class="number">0</span>, <span class="string">'subsample'</span>: <span class="number">1.0</span>, </div><div class="line">             <span class="string">'colsample_bytree'</span>: <span class="number">0.8</span>, <span class="string">'scale_pos_weight'</span>:<span class="number">10</span>, <span class="string">'eta'</span>: <span class="number">0.1</span>, <span class="string">'silent'</span>: <span class="number">1</span>, <span class="string">'objective'</span>: <span class="string">'binary:logistic'</span>,</div><div class="line">             <span class="string">'eval_metric'</span>:<span class="string">'auc'</span>&#125;</div><div class="line"><span class="comment">#     param = &#123;'n_estimators': 4000, 'max_depth': 6, 'seed': 7, 'min_child_weight': 5, 'gamma': 0, 'subsample': 1.0, </span></div><div class="line"><span class="comment">#              'colsample_bytree': 0.8, 'scale_pos_weight': 1, 'eta': 0.09, 'silent': 1, 'objective': 'binary:logistic',</span></div><div class="line"><span class="comment">#              'eval_metric':'auc'&#125;</span></div><div class="line">    </div><div class="line">    num_round = param[<span class="string">'n_estimators'</span>]</div><div class="line"><span class="comment">#     param['nthread'] = 4</span></div><div class="line">    <span class="comment"># param['eval_metric'] = "auc"</span></div><div class="line">    plst = param.items()</div><div class="line">    evallist = [(dtrain, <span class="string">'train'</span>), (dvalid, <span class="string">'eval'</span>)]</div><div class="line"><span class="comment">#     evallist = [(dvalid, 'eval'), (dtrain, 'train')]</span></div><div class="line"><span class="comment">#     evallist = [(dtrain, 'train')]</span></div><div class="line">    bst = xgb.train(plst, dtrain, num_round, evallist, early_stopping_rounds=<span class="number">10</span>)</div><div class="line">    bst.save_model(<span class="string">'bst.model'</span>)</div><div class="line">    <span class="keyword">return</span> bst, features</div><div class="line"></div><div class="line">bst_xgb, features = xgb_model(<span class="string">'train_set.csv'</span>)</div></pre></td></tr></table></figure>
<pre><code>total features:  301
[0]    train-auc:0.913108    eval-auc:0.911621
Multiple eval metrics have been passed: &apos;eval-auc&apos; will be used for early stopping.

Will train until eval-auc hasn&apos;t improved in 10 rounds.
[1]    train-auc:0.932872    eval-auc:0.930423
[2]    train-auc:0.936241    eval-auc:0.93338
...
[416]    train-auc:0.982069    eval-auc:0.976755
[417]    train-auc:0.982076    eval-auc:0.976751
[418]    train-auc:0.982087    eval-auc:0.976753
Stopping. Best iteration:
[408]    train-auc:0.981964    eval-auc:0.976777
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> bst_xgb.attributes()</div></pre></td></tr></table></figure>
<pre><code>{&apos;best_iteration&apos;: &apos;408&apos;, &apos;best_msg&apos;: &apos;[408]\ttrain-auc:0.981964\teval-auc:0.976777&apos;, &apos;best_score&apos;: &apos;0.976777&apos;}
</code></pre><h3 id="对验证集进行线下测试"><a href="#对验证集进行线下测试" class="headerlink" title="对验证集进行线下测试"></a>对验证集进行线下测试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">report</span><span class="params">(pred, label)</span>:</span></div><div class="line"></div><div class="line">    actions = label</div><div class="line">    result = pred</div><div class="line"></div><div class="line">    <span class="comment"># 所有实际用户商品对</span></div><div class="line">    all_user_item_pair = actions[<span class="string">'user_id'</span>].map(str) + <span class="string">'-'</span> + actions[<span class="string">'sku_id'</span>].map(str)</div><div class="line">    all_user_item_pair = np.array(all_user_item_pair)</div><div class="line">    <span class="comment"># 所有购买用户</span></div><div class="line">    all_user_set = actions[<span class="string">'user_id'</span>].unique()</div><div class="line"></div><div class="line">    <span class="comment"># 所有预测购买的用户</span></div><div class="line">    all_user_test_set = result[<span class="string">'user_id'</span>].unique()</div><div class="line">    all_user_test_item_pair = result[<span class="string">'user_id'</span>].map(str) + <span class="string">'-'</span> + result[<span class="string">'sku_id'</span>].map(str)</div><div class="line">    all_user_test_item_pair = np.array(all_user_test_item_pair)</div><div class="line"></div><div class="line">    <span class="comment"># 计算所有用户购买评价指标</span></div><div class="line">    pos, neg = <span class="number">0</span>,<span class="number">0</span></div><div class="line">    <span class="keyword">for</span> user_id <span class="keyword">in</span> all_user_test_set:</div><div class="line">        <span class="keyword">if</span> user_id <span class="keyword">in</span> all_user_set:</div><div class="line">            pos += <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            neg += <span class="number">1</span></div><div class="line">    all_user_acc = <span class="number">1.0</span> * pos / ( pos + neg)</div><div class="line">    all_user_recall = <span class="number">1.0</span> * pos / len(all_user_set)</div><div class="line">    <span class="keyword">print</span> <span class="string">'所有用户中预测购买用户的准确率为 '</span> + str(all_user_acc)</div><div class="line">    <span class="keyword">print</span> <span class="string">'所有用户中预测购买用户的召回率'</span> + str(all_user_recall)</div><div class="line"></div><div class="line">    pos, neg = <span class="number">0</span>, <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> user_item_pair <span class="keyword">in</span> all_user_test_item_pair:</div><div class="line">        <span class="keyword">if</span> user_item_pair <span class="keyword">in</span> all_user_item_pair:</div><div class="line">            pos += <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            neg += <span class="number">1</span></div><div class="line">    all_item_acc = <span class="number">1.0</span> * pos / ( pos + neg)</div><div class="line">    all_item_recall = <span class="number">1.0</span> * pos / len(all_user_item_pair)</div><div class="line">    <span class="keyword">print</span> <span class="string">'所有用户中预测购买商品的准确率为 '</span> + str(all_item_acc)</div><div class="line">    <span class="keyword">print</span> <span class="string">'所有用户中预测购买商品的召回率'</span> + str(all_item_recall)</div><div class="line">    F11 = <span class="number">6.0</span> * all_user_recall * all_user_acc / (<span class="number">5.0</span> * all_user_recall + all_user_acc)</div><div class="line">    F12 = <span class="number">5.0</span> * all_item_acc * all_item_recall / (<span class="number">2.0</span> * all_item_recall + <span class="number">3</span> * all_item_acc)</div><div class="line">    score = <span class="number">0.4</span> * F11 + <span class="number">0.6</span> * F12</div><div class="line">    <span class="keyword">print</span> <span class="string">'F11='</span> + str(F11)</div><div class="line">    <span class="keyword">print</span> <span class="string">'F12='</span> + str(F12)</div><div class="line">    <span class="keyword">print</span> <span class="string">'score='</span> + str(score)</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> all_user_acc, all_user_recall, F11, all_item_acc, all_item_recall, F12, score</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(valid_set, val_label, model)</span>:</span></div><div class="line">    actions = pd.read_csv(valid_set)                <span class="comment">#read test_set        </span></div><div class="line"><span class="comment">#     users = actions[['user_id', 'sku_id']].copy()</span></div><div class="line">    <span class="comment"># 避免预测到非8类商品，所以最后还是再筛一遍的好        </span></div><div class="line">    users = actions[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'cate'</span>]].copy()</div><div class="line">    </div><div class="line">    actions[<span class="string">'user_id'</span>] = actions[<span class="string">'user_id'</span>].astype(np.int64)</div><div class="line"><span class="comment">#     test_label= actions[actions['label'] == 1]</span></div><div class="line"></div><div class="line"><span class="comment">#     test_label= actions[(actions['label']==1) &amp; (actions['cate']==8)]</span></div><div class="line">    test_label = pd.read_csv(val_label)</div><div class="line">    </div><div class="line">    lst_useless = [<span class="string">'brand'</span>]</div><div class="line">    </div><div class="line">    actions.drop(lst_useless, inplace=<span class="keyword">True</span>, axis=<span class="number">1</span>)</div><div class="line">    </div><div class="line"><span class="comment">#     test_label = test_label[['user_id','sku_id','label']]</span></div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'user_id'</span>]</div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'sku_id'</span>]</div><div class="line">    </div><div class="line"><span class="comment">#     features = list(actions.columns.values)</span></div><div class="line">    </div><div class="line"><span class="comment">#     del actions['label']</span></div><div class="line">    sub_user_index = users</div><div class="line"><span class="comment">#     sub_trainning_data = xgb.DMatrix(actions.values, feature_names=features)</span></div><div class="line">    sub_trainning_data = xgb.DMatrix(actions.values)</div><div class="line"><span class="comment">#     y = model.predict(sub_trainning_data,ntree_limit=model.best_iteration)</span></div><div class="line">    y = model.predict(sub_trainning_data, ntree_limit=model.best_ntree_limit)</div><div class="line">    sub_user_index[<span class="string">'label'</span>] = y</div><div class="line">    </div><div class="line">    sub_user_index.to_csv(<span class="string">'result_'</span> + valid_set, index=<span class="keyword">False</span>)</div><div class="line">    </div><div class="line"><span class="comment">#     sub_user_index = sub_user_index[sub_user_index['cate']==8]</span></div><div class="line"><span class="comment">#     del sub_user_index['cate']</span></div><div class="line">    rank = <span class="number">1000</span></div><div class="line">    pred = sub_user_index.sort_values(by=<span class="string">'label'</span>, ascending=<span class="keyword">False</span>)[:rank]</div><div class="line"><span class="comment">#     pred = sub_user_index[sub_user_index['label'] &gt;= 0.05]</span></div><div class="line">    </div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of raw pred users: '</span>, len(pred[<span class="string">'user_id'</span>].unique())</div><div class="line">    pred = pred[pred[<span class="string">'cate'</span>]==<span class="number">8</span>]</div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of pred users bought cate 8: '</span>, len(pred[<span class="string">'user_id'</span>].unique())</div><div class="line">    </div><div class="line"><span class="comment">#     pred = pred[['user_id', 'sku_id']]</span></div><div class="line">    pred = pred[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'label'</span>]]</div><div class="line">    pred = pred.groupby(<span class="string">'user_id'</span>).first().reset_index()</div><div class="line">    pred[<span class="string">'user_id'</span>] = pred[<span class="string">'user_id'</span>].astype(int)</div><div class="line">    pred[<span class="string">'sku_id'</span>] = pred[<span class="string">'sku_id'</span>].astype(int)</div><div class="line">    </div><div class="line"><span class="comment">#     print 'No. of pred users after deduplicates: ', len(pred['user_id'].unique())</span></div><div class="line">    true_user = len(test_label[<span class="string">'user_id'</span>])   </div><div class="line">    pred_ui = len(pred[<span class="string">'user_id'</span>].unique())</div><div class="line">    <span class="keyword">print</span> <span class="string">'pred item: '</span>, len(pred[<span class="string">'sku_id'</span>].unique())</div><div class="line">    <span class="keyword">print</span> <span class="string">'true users: '</span>, true_user</div><div class="line">    <span class="keyword">print</span> <span class="string">'pred users: '</span>, pred_ui</div><div class="line">    test_label[<span class="string">'user_id'</span>] = test_label[<span class="string">'user_id'</span>].astype(int)</div><div class="line">    test_label[<span class="string">'sku_id'</span>] = test_label[<span class="string">'sku_id'</span>].astype(int)</div><div class="line"></div><div class="line">    all_user_acc, all_user_recall, F11, all_item_acc, all_item_recall, F12, score = report(pred, test_label)   </div><div class="line">    </div><div class="line">    f_name = <span class="string">'pred_'</span> + str(rank) + <span class="string">'_'</span> + valid_set</div><div class="line">    pred.to_csv(f_name, index=<span class="keyword">False</span>)</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> rank, true_user, pred_ui, all_user_acc, all_user_recall, F11, all_item_acc, all_item_recall, F12, score</div><div class="line"></div><div class="line"><span class="comment"># validate('val_set.csv', bst_xgb)</span></div></pre></td></tr></table></figure>
<p>评分文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">avg_score</span><span class="params">()</span>:</span></div><div class="line">    rank1, true_user1, pred_ui1, user_acc1, user_recall1, F11_1, item_acc1, item_recall1, F12_1, score1 = validate(<span class="string">'val_1.csv'</span>, <span class="string">'label_val_1.csv'</span>, bst_xgb)</div><div class="line">    <span class="keyword">print</span> <span class="string">'-------------------------------------------'</span></div><div class="line">    rank2, true_user2, pred_ui2, user_acc2, user_recall2, F11_2, item_acc2, item_recall2, F12_2, score2 = validate(<span class="string">'val_2.csv'</span>, <span class="string">'label_val_2.csv'</span>, bst_xgb)</div><div class="line">    <span class="keyword">print</span> <span class="string">'-------------------------------------------'</span></div><div class="line">    rank3, true_user3, pred_ui3, user_acc3, user_recall3, F11_3, item_acc3, item_recall3, F12_3, score3 = validate(<span class="string">'val_3.csv'</span>, <span class="string">'label_val_3.csv'</span>, bst_xgb)</div><div class="line">    <span class="keyword">print</span> <span class="string">'==========================================='</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'avg user acc: '</span>, (user_acc1+user_acc2+user_acc3)/<span class="number">3</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'avg user recall: '</span>, (user_recall1+user_recall2+user_recall3)/<span class="number">3</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'avg item acc: '</span>, (item_acc1+item_acc2+item_acc3)/<span class="number">3</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'avg item recall: '</span>, (item_recall1+item_recall2+item_recall3)/<span class="number">3</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'avg F11: '</span>, (F11_1+F11_2+F11_3)/<span class="number">3</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'avg F12: '</span>, (F12_1+F12_2+F12_3)/<span class="number">3</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'avg score: '</span>, (score1+score2+score3)/<span class="number">3</span></div><div class="line">    <span class="comment"># make the csv file</span></div><div class="line">    dct_score = &#123;&#125;</div><div class="line">    dct_score[<span class="string">'rank'</span>] = [rank1, rank2, rank3]</div><div class="line">    dct_score[<span class="string">'true_user'</span>] = [true_user1, true_user2, true_user3]</div><div class="line">    dct_score[<span class="string">'pred_ui'</span>] = [pred_ui1, pred_ui2, pred_ui3]</div><div class="line">    dct_score[<span class="string">'user_acc'</span>] = [user_acc1, user_acc2, user_acc3]</div><div class="line">    dct_score[<span class="string">'user_recall'</span>] = [user_recall1, user_recall2, user_recall3]</div><div class="line">    dct_score[<span class="string">'F11'</span>] = [F11_1, F11_2, F11_3]</div><div class="line">    dct_score[<span class="string">'item_acc'</span>] = [item_acc1, item_acc2, item_acc3]</div><div class="line">    dct_score[<span class="string">'item_recall'</span>] = [item_recall1, item_recall2, item_recall3]</div><div class="line">    dct_score[<span class="string">'F12'</span>] = [F12_1, F12_2, F12_3]</div><div class="line">    dct_score[<span class="string">'score'</span>] = [score1, score2, score3]</div><div class="line">    column_order = [<span class="string">'rank'</span>, <span class="string">'true_user'</span>, <span class="string">'pred_ui'</span>, <span class="string">'user_acc'</span>, <span class="string">'user_recall'</span>, <span class="string">'item_acc'</span>, <span class="string">'item_recall'</span>, <span class="string">'F11'</span>, <span class="string">'F12'</span>, </div><div class="line">                    <span class="string">'score'</span>]</div><div class="line">    df_score = pd.DataFrame(dct_score)</div><div class="line">    file_name = <span class="string">'score_'</span> + str(datetime.now().date())[<span class="number">5</span>:] +<span class="string">'_'</span>+ str(rank1) + <span class="string">'.csv'</span></div><div class="line">    df_score[column_order].to_csv(file_name, index=<span class="keyword">False</span>)</div><div class="line">avg_score()</div></pre></td></tr></table></figure>
<pre><code>No. of raw pred users:  950
No. of pred users bought cate 8:  950
pred item:  220
true users:  1211
pred users:  950
所有用户中预测购买用户的准确率为 0.147368421053
所有用户中预测购买用户的召回率0.116569525396
所有用户中预测购买商品的准确率为 0.108421052632
所有用户中预测购买商品的召回率0.0850536746491
F11=0.141152747437
F12=0.0930778962588
score=0.11230783673
-------------------------------------------
No. of raw pred users:  950
No. of pred users bought cate 8:  950
pred item:  203
true users:  1259
pred users:  950
所有用户中预测购买用户的准确率为 0.163157894737
所有用户中预测购买用户的召回率0.12360446571
所有用户中预测购买商品的准确率为 0.116842105263
所有用户中预测购买商品的召回率0.0881652104845
F11=0.15489673551
F12=0.0977629029417
score=0.120616435969
-------------------------------------------
No. of raw pred users:  960
No. of pred users bought cate 8:  960
pred item:  219
true users:  1385
pred users:  960
所有用户中预测购买用户的准确率为 0.161458333333
所有用户中预测购买用户的召回率0.11231884058
所有用户中预测购买商品的准确率为 0.120833333333
所有用户中预测购买商品的召回率0.0837545126354
F11=0.150485436893
F12=0.0954732510288
score=0.117478125375
===========================================
avg user acc:  0.157328216374
avg user recall:  0.117497610562
avg item acc:  0.115365497076
avg item recall:  0.0856577992563
avg F11:  0.14884497328
avg F12:  0.0954380167431
avg score:  0.116800799358
</code></pre><h3 id="输出特征重要性"><a href="#输出特征重要性" class="headerlink" title="输出特征重要性"></a>输出特征重要性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">feature_importance</span><span class="params">(bst_xgb)</span>:</span></div><div class="line">    importance = bst_xgb.get_fscore(fmap=<span class="string">r'xgb.fmap'</span>)</div><div class="line">    importance = sorted(importance.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    df = pd.DataFrame(importance, columns=[<span class="string">'feature'</span>, <span class="string">'fscore'</span>])</div><div class="line">    df[<span class="string">'fscore'</span>] = df[<span class="string">'fscore'</span>] / df[<span class="string">'fscore'</span>].sum()</div><div class="line">    file_name = <span class="string">'feature_importance_'</span> + str(datetime.now().date())[<span class="number">5</span>:] + <span class="string">'.csv'</span></div><div class="line">    df.to_csv(file_name)</div><div class="line"></div><div class="line">feature_importance(bst_xgb)</div></pre></td></tr></table></figure>
<h3 id="生成提交结果"><a href="#生成提交结果" class="headerlink" title="生成提交结果"></a>生成提交结果</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># sub_file</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(pred_set, model)</span>:</span></div><div class="line">    actions = pd.read_csv(pred_set)                <span class="comment">#read test_set</span></div><div class="line">    </div><div class="line"><span class="comment">#     print 'total user before: ', len(actions['user_id'].unique())</span></div><div class="line"><span class="comment">#     potential = pd.read_csv('potential_user_04-28.csv')</span></div><div class="line"><span class="comment">#     lst_user = potential['user_id'].unique().tolist()</span></div><div class="line"><span class="comment">#     actions = actions[actions['user_id'].isin(lst_user)]</span></div><div class="line"><span class="comment">#     print 'total user after: ', len(actions['user_id'].unique())</span></div><div class="line">    <span class="comment"># 提前去掉部分特征</span></div><div class="line">    lst_useless = [<span class="string">'brand'</span>]</div><div class="line">    </div><div class="line">    actions.drop(lst_useless, inplace=<span class="keyword">True</span>, axis=<span class="number">1</span>)</div><div class="line"></div><div class="line">    </div><div class="line">    users = actions[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>, <span class="string">'cate'</span>]].copy()</div><div class="line"><span class="comment">#     users = actions[['user_id', 'sku_id']].copy()</span></div><div class="line">    </div><div class="line">    actions[<span class="string">'user_id'</span>] = actions[<span class="string">'user_id'</span>].astype(np.int64)</div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'user_id'</span>]</div><div class="line">    <span class="keyword">del</span> actions[<span class="string">'sku_id'</span>]</div><div class="line">    sub_user_index = users</div><div class="line">    sub_trainning_data = xgb.DMatrix(actions.values)</div><div class="line">    y = model.predict(sub_trainning_data, ntree_limit=model.best_ntree_limit)</div><div class="line">    sub_user_index[<span class="string">'label'</span>] = y</div><div class="line">    </div><div class="line"><span class="comment">#     sub_user_index = sub_user_index[sub_user_index['cate']==8]</span></div><div class="line"><span class="comment">#     del sub_user_index['cate']</span></div><div class="line">    rank = <span class="number">1200</span></div><div class="line">    pred = sub_user_index.sort_values(by=<span class="string">'label'</span>, ascending=<span class="keyword">False</span>)[:rank]</div><div class="line"><span class="comment">#     pred = sub_user_index[sub_user_index['label'] &gt;= 0.05]</span></div><div class="line"><span class="comment">#     pred = pred[['user_id', 'sku_id', 'label']]</span></div><div class="line"><span class="comment">#     pred = pred[pred['label']&gt;0.45]</span></div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of raw pred users: '</span>, len(pred[<span class="string">'user_id'</span>].unique())</div><div class="line">    pred = pred[pred[<span class="string">'cate'</span>]==<span class="number">8</span>]</div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of pred users bought cate 8: '</span>, len(pred[<span class="string">'user_id'</span>].unique())</div><div class="line"></div><div class="line">    pred = pred[[<span class="string">'user_id'</span>, <span class="string">'sku_id'</span>]]</div><div class="line"><span class="comment">#     print </span></div><div class="line">    pred = pred.groupby(<span class="string">'user_id'</span>).first().reset_index()</div><div class="line">    pred[<span class="string">'user_id'</span>] = pred[<span class="string">'user_id'</span>].astype(int)</div><div class="line">    pred[<span class="string">'sku_id'</span>] = pred[<span class="string">'sku_id'</span>].astype(int)</div><div class="line">    sub_file = <span class="string">'submission_'</span> + str(rank) + <span class="string">'_'</span> + str(datetime.now().date())[<span class="number">5</span>:] + <span class="string">'.csv'</span></div><div class="line"><span class="comment">#     sub_file = 'submission_detail_' + str(datetime.now().date())[5:] + '.csv'</span></div><div class="line">    pred.to_csv(sub_file, index=<span class="keyword">False</span>, index_label=<span class="keyword">False</span>)  </div><div class="line"></div><div class="line">submit(<span class="string">'test_set.csv'</span>, bst_xgb)</div></pre></td></tr></table></figure>
<pre><code>No. of raw pred users:  1142
No. of pred users bought cate 8:  1142
</code></pre><h3 id="提交结果除重（可选）"><a href="#提交结果除重（可选）" class="headerlink" title="提交结果除重（可选）"></a>提交结果除重（可选）</h3><p>除去最后临近三天的发生购买行为的用户商品对</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub_improv</span><span class="params">(action, sub_file)</span>:</span></div><div class="line">    <span class="comment"># 获取4月最近三天的目标用户商品对</span></div><div class="line">    action_4 = pd.read_csv(action)</div><div class="line">    action_4[<span class="string">'time'</span>] = pd.to_datetime(action_4[<span class="string">'time'</span>]).apply(<span class="keyword">lambda</span> x: x.date())</div><div class="line">    aim_date = [datetime.strptime(s, <span class="string">'%Y-%m-%d'</span>).date() <span class="keyword">for</span> s <span class="keyword">in</span> [<span class="string">'2016-04-09'</span>, <span class="string">'2016-04-10'</span>, <span class="string">'2016-04-11'</span> ,</div><div class="line">                                                                  <span class="string">'2016-04-12'</span>, <span class="string">'2016-04-13'</span>, <span class="string">'2016-04-14'</span>, </div><div class="line">                                                                  <span class="string">'2016-04-15'</span>]]</div><div class="line">    aim_action = action_4[(action_4[<span class="string">'type'</span>]==<span class="number">4</span>) &amp; (action_4[<span class="string">'cate'</span>]==<span class="number">8</span>) &amp; (action_4[<span class="string">'time'</span>].isin(aim_date))]</div><div class="line">    aim_ui = aim_action[<span class="string">'user_id'</span>].map(int).map(str) + <span class="string">'-'</span> + aim_action[<span class="string">'sku_id'</span>].map(str)</div><div class="line">    <span class="comment"># 拼接提交数据的用户商品</span></div><div class="line">    sub = pd.read_csv(sub_file)</div><div class="line">    before = sub.shape[<span class="number">0</span>]</div><div class="line">    sub_ui = sub[<span class="string">'user_id'</span>].map(str) + <span class="string">'-'</span> + sub[<span class="string">'sku_id'</span>].map(str)</div><div class="line">    <span class="comment"># 交集</span></div><div class="line">    lst_aim = aim_ui.unique().tolist()</div><div class="line">    lst_sub = sub_ui.unique().tolist()</div><div class="line">    lst_common = [i <span class="keyword">for</span> i <span class="keyword">in</span> lst_aim <span class="keyword">if</span> i <span class="keyword">in</span> lst_sub]</div><div class="line">    dct_ui = &#123;i.split(<span class="string">'-'</span>)[<span class="number">0</span>]: i.split(<span class="string">'-'</span>)[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> lst_common&#125;</div><div class="line">    <span class="comment"># 从提交结果除掉交集部分</span></div><div class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> dct_ui:</div><div class="line">        sub.drop(sub[(sub[<span class="string">'user_id'</span>]==int(k)) &amp; (sub[<span class="string">'sku_id'</span>]==int(dct_ui[k]))].index, inplace=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of records after remove dup: '</span>, sub.shape[<span class="number">0</span>]</div><div class="line">    <span class="keyword">print</span> <span class="string">'No. of dup: '</span>, before - sub.shape[<span class="number">0</span>]</div><div class="line">    <span class="keyword">if</span> (before - sub.shape[<span class="number">0</span>])!=<span class="number">0</span>:</div><div class="line">        file_name = <span class="string">'submission_'</span> + str(datetime.now().date())[<span class="number">5</span>:] + <span class="string">'_improv.csv'</span></div><div class="line">        sub.to_csv(file_name, index=<span class="keyword">False</span>, index_label=<span class="keyword">False</span>)</div><div class="line">    </div><div class="line">sub_improv(<span class="string">'data/JData_Action_201604.csv'</span>, <span class="string">'submission_1200_05-25.csv'</span>)</div></pre></td></tr></table></figure>
<pre><code>No. of records after remove dup:  1142
No. of dup:  0
</code></pre><h2 id="比赛过程中遇到和解决的问题"><a href="#比赛过程中遇到和解决的问题" class="headerlink" title="比赛过程中遇到和解决的问题"></a>比赛过程中遇到和解决的问题</h2><h3 id="线上线下测试的分相差悬殊问题"><a href="#线上线下测试的分相差悬殊问题" class="headerlink" title="线上线下测试的分相差悬殊问题"></a>线上线下测试的分相差悬殊问题</h3><p>传入report的真实预测用户商品对有问题，之前使用滑动窗口时仅用前三天预测后五天，对后五天发生了购买(类别8)行为的用户打上标签，生成训练集、验证集，这里隐式的划定了前三天有交互的用户群体，但是事实在后五天发生购买行为的用户应该理论上不小于这个数目(存在用户前三天并无交互但是在后五天发生购买行为的情况)，所以在计算report中的callback等值时传入的应该是这5天实际购买的用户行为记录，修改后，线上线下测试误差控制在0.01左右</p>
<h3 id="线下测试集组数"><a href="#线下测试集组数" class="headerlink" title="线下测试集组数"></a>线下测试集组数</h3><p>开始只设定了一组，导致有时候线下线上的变化不一致，后期设定了三组并结合三组的输出以及均值判断，基本能保证线上线下成绩同步</p>
<h3 id="编码问题"><a href="#编码问题" class="headerlink" title="编码问题"></a>编码问题</h3><p>文件本身是gbk编码，其中的年龄属性就是中文的，导致转换时经常出现编码错误，后来修改了独热编码部分的代码，一开始对年龄这类含有中文的特征进行独热编码前，先将文本转化为数值（用数字表示类别）LabelEncoder + get_dummies()<a href="https://ask.hellobi.com/blog/DataMiner/4897" target="_blank" rel="external">来源</a></p>
<h3 id="feature-importance列未对应，导致一段时间分析的特征重要性文件存在问题，产生误导"><a href="#feature-importance列未对应，导致一段时间分析的特征重要性文件存在问题，产生误导" class="headerlink" title="feature_importance列未对应，导致一段时间分析的特征重要性文件存在问题，产生误导"></a>feature_importance列未对应，导致一段时间分析的特征重要性文件存在问题，产生误导</h3><h3 id="合并数据集时产生空值，由数据不一致造成"><a href="#合并数据集时产生空值，由数据不一致造成" class="headerlink" title="合并数据集时产生空值，由数据不一致造成"></a>合并数据集时产生空值，由数据不一致造成</h3><p>手动添加一些特征列并填充缺失值，此外注意拼接的键</p>
<h3 id="除零出现无限值"><a href="#除零出现无限值" class="headerlink" title="除零出现无限值"></a>除零出现无限值</h3><p>平滑部分除零特征</p>
<h3 id="优化时间计算效率"><a href="#优化时间计算效率" class="headerlink" title="优化时间计算效率"></a>优化时间计算效率</h3><p>开始时，构建时间差的地方用到了日期和字符串转换等操作，apply等比较费时，后面不使用apply而且一次性全部计算所有时间差并优先存储到数据中直接读入，提升了特征构建的速度</p>
<h2 id="失败的尝试以及未尝试的"><a href="#失败的尝试以及未尝试的" class="headerlink" title="失败的尝试以及未尝试的"></a>失败的尝试以及未尝试的</h2><ul>
<li>是否自定义衡量标准，而不使用roc-auc? <a href="https://github.com/dmlc/xgboost/blob/master/demo/guide-python/custom_objective.py" target="_blank" rel="external">参照</a></li>
<li>正负例比例不均的问题是否使用权重来矫正？<a href="https://github.com/dmlc/xgboost/blob/master/demo/guide-python/cross_validation.py" target="_blank" rel="external">参照</a><ul>
<li>参数：scale_pos_weight</li>
<li>DMatrix中的weight</li>
<li>尝试设置正负比例的参数，特别分阶段而且没有采样的条件下，不同阶段模型里的正负例是不一样的，尝试过，可能是提前随机欠抽样导致本身数据的随机性而再修改该属性反而没有效果；但是考虑到本身使用滑窗会产生大量数据，若不采样则机器内存不足以承受，而且后面尝试另一种滑窗的方法并不采样使用scale_pos_weight却也并无改善，可能需要参考《机器学习》使用EasyEnsemble的方法</li>
</ul>
</li>
<li>分阶段预测<br>第一阶段预测用户，第二阶段预测前一阶段预测出的用户可能购买的商品<br>设计特征如何分割和构建的问题以及标签的问题没有解决，导致失败</li>
<li>打标签方式的尝试<br>差别不大</li>
<li>时间窗的修改<br>最后是要预测五天内的购买，我们可以先随机取几个五天发生购买的用户，看看这些用户与所购买商品的交互时间周期覆盖率较大的一个值，然后反过来取另外的时间周期的交互用户商品对，看看这些里面有多少在时间周期后五天发生了购买行为，主要是交互周期的一个覆盖率问题<br>将对这三个月购买过的类别8商品后五天之前14天有过交互的所有用户商品对提取出来，而这里面根据前面所分析的，可以涵盖所有存在交互的用户商品对的80%的用户<br>但实际上虽然这14天能覆盖到80%的用户商品对，但是其实这部分用户商品对在不少交互其实只是在这14天的前面的某几天出现过，而后续并未进一步交互，虽然最后发生了购买行为，但是对于我们通过统计交互行为来构建特征的方法并没有什么帮助，反而扩大的时间窗囊括进了大量的噪声数据致使结果变糟</li>
<li>平滑特征</li>
<li>去重</li>
<li>填充空值</li>
<li>优化问题，如何加速训练</li>
<li>时间窗口构造上避开统计结果中的高峰、低谷时间区间<br>效果反而变差</li>
<li>其他模型以及模型融合<br>尝试过lightgbm,randomforest,gbdt，以及averaging但是效果不佳</li>
</ul>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>以上大概是本次比赛的一个简要的流程，完整的代码可以到我的<a href="https://github.com/LancelotHolmes/JData" target="_blank" rel="external">github</a>查看，下面简要回顾下本次比赛的收获和有待进一步改进的地方</p>
<ul>
<li>团队合作很重要，特别是队员之间工作协调好，此外code review非常重要</li>
<li>对数据的分析是很关键的，只有通过统计分析才能说明你对数据的了解，你以为的常识是靠不住的</li>
<li>有想法在分析过后的基础上最好马上实践来验证，并做好相应的记录</li>
<li>做好分析记录很重要，无论是过程中的数据分析、特征尝试还是模型的参数调整；另外后面线下验证的过程也有必要做记录，毕竟线上测试机会有限，线下测试做的好、记录完备可以提高成绩</li>
<li>如开头所述，如何选取恰当的时间区间来预测用户商品对以及最近一段时间没有交互记录的用户商品对该如何挖掘出来是个难题</li>
<li>本次最终只提交了xgboost单模型的预测，后期也有尝试lightgbm、RandomForest、GBDT等模型，但是效果不是很好，而且时间仓促，模型集成这块也来不及做，尝试了bagging但是效果不是很好</li>
<li>数据本身存在正负比例不均的问题，查阅过一些资料，最后使用的是随机欠采样负例按与正例1：10的比例构建训练集，但是这种方法随机性较大，造成结果不稳定，对训练集敏感性较强，应该还有更好的方法</li>
<li>特征筛选问题，中间为了快速提高成绩，一味的添加特征，对于特征却没有进行适当的筛选，后期聚集了上百个特征却难以筛选，尝试过方差法、通过xgboost模型本身输出的特征重要性来筛选，但是效果不佳，这一块应该还有很多提升空间</li>
<li>关于分步预测的问题，也有尝试过按照群里大神提到的分阶段预测，即第一阶段仅预测未来可能会购买的用户，第二阶段预测这部分用户可能购买的商品，然而中间尝试很长一段时间效果不好，主要是不同阶段之间特征的取舍和冲突，最终效果不好而作罢，但是不失为一种思路</li>
</ul>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">ML</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">JData</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">比赛</a>
        		</li>
      		
		</ul>
	</div>

      

      

      
        
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="http://s.jiathis.com/qrcode.php?url=http://yoursite.com/2017/06/25/JData/" alt="微信分享二维码">
    </div>
</div>

<div class="mask js-mask"></div>
      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2017/06/27/basic-algorithm/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          基础算法小记
        
      </div>
    </a>
  
  
    <a href="/2017/06/22/Statistics/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">概率统计小记</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>





  
  
  

  

  
    <section id="comments">
      <div id="disqus_thread"></div>
        <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'LancelotHolmes'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        $

      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </section>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 懒死骆驼
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(194),t.exports=r(190)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(202);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(381)),d=e(p),y=r(128),g=e(y),b=r(189),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(380),r(390),r(197),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(209),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(201);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(207),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(208)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":""
;return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(203))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(205),g=r(204),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){
return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(206),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(329),r(268),r(270),r(269),r(272),r(274),r(279),r(273),r(271),r(281),r(280),r(276),r(277),r(275),r(267),r(278),r(282),r(283),r(235),r(237),r(236),r(285),r(284),r(255),r(265),r(266),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(238),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(316),r(321),r(328),r(319),r(311),r(312),r(317),r(322),r(324),r(307),r(308),r(309),r(310),r(313),r(314),r(315),r(318),r(320),r(323),r(325),r(326),r(327),r(230),r(232),r(231),r(234),r(233),r(219),r(217),r(223),r(220),r(226),r(228),r(216),r(222),r(213),r(227),r(211),r(225),r(224),r(218),r(221),r(210),r(212),r(215),r(214),r(229),r(155),r(301),r(306),r(184),r(302),r(303),r(304),r(305),r(286),r(183),r(185),r(186),r(341),r(330),r(331),r(336),r(339),r(340),r(334),r(337),r(335),r(338),r(332),r(333),r(287),r(288),r(289),r(290),r(291),r(294),r(292),r(293),r(295),r(296),r(297),r(298),r(300),r(299),r(342),r(368),r(371),r(370),r(372),r(373),r(369),r(374),r(375),r(353),r(356),r(352),r(350),r(351),r(354),r(355),r(345),r(367),r(376),r(344),r(346),r(348),r(347),r(349),r(358),r(359),r(361),r(360),r(363),r(362),r(364),r(365),r(366),r(343),r(357),r(379),r(378),r(377),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.b3331d.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.445162.js")}()</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">ML</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Kaggle</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Python</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Note</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">统计学习方法</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Perceptron</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">统计学</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">algorithm</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">校招</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">面试</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Coding</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">decision tree</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Reading</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">IT</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">k-NN</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">GBDT</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">CV</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">model selection</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">LR</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">机器学习</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">ensemble</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">剑指offer</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">offer</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">blog</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">hexo</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">yilia</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">最优化问题</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">Novel</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">SVM</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">memo</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">parameter</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">hyperparameter</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Economy</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">JData</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">比赛</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="https://segmentfault.com/u/fornever" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>segmentfault</a>
            </li>
          
            <li class="search-li">
              <a href="https://zhangslob.github.io/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>崔斯特的博客</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">东南大学在读小硕一枚&lt;br&gt;研究方向是数据挖掘&amp;机器学习&lt;br&gt;努力修炼中...</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>